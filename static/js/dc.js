(function(){function _dc(d3,crossfilter){'use strict';var dc={version:'2.0.0-beta.9',constants:{CHART_CLASS:'dc-chart',DEBUG_GROUP_CLASS:'debug',STACK_CLASS:'stack',DESELECTED_CLASS:'deselected',SELECTED_CLASS:'selected',NODE_INDEX_NAME:'__index__',GROUP_INDEX_NAME:'__group_index__',DEFAULT_CHART_GROUP:'__default_chart_group__',EVENT_DELAY:40,NEGLIGIBLE_NUMBER:1e-10},_renderlet:null};dc.chartRegistry=function(){var _chartMap={};function initializeChartGroup(group){if(!group){group=dc.constants.DEFAULT_CHART_GROUP;}
if(!_chartMap[group]){_chartMap[group]=[];}
return group;}
return{has:function(chart){for(var e in _chartMap){if(_chartMap[e].indexOf(chart)>=0){return true;}}
return false;},register:function(chart,group){group=initializeChartGroup(group);_chartMap[group].push(chart);},deregister:function(chart,group){group=initializeChartGroup(group);for(var i=0;i<_chartMap[group].length;i++){if(_chartMap[group][i].anchorName()===chart.anchorName()){_chartMap[group].splice(i,1);break;}}},clear:function(group){if(group){delete _chartMap[group];}else{_chartMap={};}},list:function(group){group=initializeChartGroup(group);return _chartMap[group];}};}();dc.registerChart=function(chart,group){dc.chartRegistry.register(chart,group);};dc.deregisterChart=function(chart,group){dc.chartRegistry.deregister(chart,group);};dc.hasChart=function(chart){return dc.chartRegistry.has(chart);};dc.deregisterAllCharts=function(group){dc.chartRegistry.clear(group);};dc.filterAll=function(group){var charts=dc.chartRegistry.list(group);for(var i=0;i<charts.length;++i){charts[i].filterAll();}};dc.refocusAll=function(group){var charts=dc.chartRegistry.list(group);for(var i=0;i<charts.length;++i){if(charts[i].focus){charts[i].focus();}}};dc.renderAll=function(group){var charts=dc.chartRegistry.list(group);for(var i=0;i<charts.length;++i){charts[i].render();}
if(dc._renderlet!==null){dc._renderlet(group);}};dc.redrawAll=function(group){var charts=dc.chartRegistry.list(group);for(var i=0;i<charts.length;++i){charts[i].redraw();}
if(dc._renderlet!==null){dc._renderlet(group);}};dc.disableTransitions=false;dc.transition=function(selections,duration,callback){if(duration<=0||duration===undefined||dc.disableTransitions){return selections;}
var s=selections.transition().duration(duration);if(typeof(callback)==='function'){callback(s);}
return s;};dc.units={};dc.units.integers=function(s,e){return Math.abs(e-s);};dc.units.ordinal=function(s,e,domain){return domain;};dc.units.fp={};dc.units.fp.precision=function(precision){var _f=function(s,e){var d=Math.abs((e-s)/_f.resolution);if(dc.utils.isNegligible(d-Math.floor(d))){return Math.floor(d);}else{return Math.ceil(d);}};_f.resolution=precision;return _f;};dc.round={};dc.round.floor=function(n){return Math.floor(n);};dc.round.ceil=function(n){return Math.ceil(n);};dc.round.round=function(n){return Math.round(n);};dc.override=function(obj,functionName,newFunction){var existingFunction=obj[functionName];obj['_'+functionName]=existingFunction;obj[functionName]=newFunction;};dc.renderlet=function(_){if(!arguments.length){return dc._renderlet;}
dc._renderlet=_;return dc;};dc.instanceOfChart=function(o){return o instanceof Object&&o.__dcFlag__&&true;};dc.errors={};dc.errors.Exception=function(msg){var _msg=msg||'Unexpected internal error';this.message=_msg;this.toString=function(){return _msg;};};dc.errors.InvalidStateException=function(){dc.errors.Exception.apply(this,arguments);};dc.dateFormat=d3.time.format('%m/%d/%Y');dc.printers={};dc.printers.filters=function(filters){var s='';for(var i=0;i<filters.length;++i){if(i>0){s+=', ';}
s+=dc.printers.filter(filters[i]);}
return s;};dc.printers.filter=function(filter){var s='';if(typeof filter!=='undefined'&&filter!==null){if(filter instanceof Array){if(filter.length>=2){s='['+dc.utils.printSingleValue(filter[0])+' -> '+dc.utils.printSingleValue(filter[1])+']';}else if(filter.length>=1){s=dc.utils.printSingleValue(filter[0]);}}else{s=dc.utils.printSingleValue(filter);}}
return s;};dc.pluck=function(n,f){if(!f){return function(d){return d[n];};}
return function(d,i){return f.call(d,d[n],i);};};dc.utils={};dc.utils.printSingleValue=function(filter){var s=''+filter;if(filter instanceof Date){s=dc.dateFormat(filter);}else if(typeof(filter)==='string'){s=filter;}else if(dc.utils.isFloat(filter)){s=dc.utils.printSingleValue.fformat(filter);}else if(dc.utils.isInteger(filter)){s=Math.round(filter);}
return s;};dc.utils.printSingleValue.fformat=d3.format('.2f');dc.utils.add=function(l,r){if(typeof r==='string'){r=r.replace('%','');}
if(l instanceof Date){if(typeof r==='string'){r=+r;}
var d=new Date();d.setTime(l.getTime());d.setDate(l.getDate()+r);return d;}else if(typeof r==='string'){var percentage=(+r/100);return l>0?l*(1+percentage):l*(1-percentage);}else{return l+r;}};dc.utils.subtract=function(l,r){if(typeof r==='string'){r=r.replace('%','');}
if(l instanceof Date){if(typeof r==='string'){r=+r;}
var d=new Date();d.setTime(l.getTime());d.setDate(l.getDate()-r);return d;}else if(typeof r==='string'){var percentage=(+r/100);return l<0?l*(1+percentage):l*(1-percentage);}else{return l-r;}};dc.utils.isNumber=function(n){return n===+n;};dc.utils.isFloat=function(n){return n===+n&&n!==(n|0);};dc.utils.isInteger=function(n){return n===+n&&n===(n|0);};dc.utils.isNegligible=function(n){return!dc.utils.isNumber(n)||(n<dc.constants.NEGLIGIBLE_NUMBER&&n>-dc.constants.NEGLIGIBLE_NUMBER);};dc.utils.clamp=function(val,min,max){return val<min?min:(val>max?max:val);};var _idCounter=0;dc.utils.uniqueId=function(){return++_idCounter;};dc.utils.nameToId=function(name){return name.toLowerCase().replace(/[\s]/g,'_').replace(/[\.']/g,'');};dc.utils.appendOrSelect=function(parent,selector,tag){tag=tag||selector;var element=parent.select(selector);if(element.empty()){element=parent.append(tag);}
return element;};dc.utils.safeNumber=function(n){return dc.utils.isNumber(+n)?+n:0;};dc.logger={};dc.logger.enableDebugLog=false;dc.logger.warn=function(msg){if(console){if(console.warn){console.warn(msg);}else if(console.log){console.log(msg);}}
return dc.logger;};dc.logger.debug=function(msg){if(dc.logger.enableDebugLog&&console){if(console.debug){console.debug(msg);}else if(console.log){console.log(msg);}}
return dc.logger;};dc.logger.deprecate=function(fn,msg){var warned=false;function deprecated(){if(!warned){dc.logger.warn(msg);warned=true;}
return fn.apply(this,arguments);}
return deprecated;};dc.events={current:null};dc.events.trigger=function(closure,delay){if(!delay){closure();return;}
dc.events.current=closure;setTimeout(function(){if(closure===dc.events.current){closure();}},delay);};dc.filters={};dc.filters.RangedFilter=function(low,high){var range=new Array(low,high);range.isFiltered=function(value){return value>=this[0]&&value<this[1];};return range;};dc.filters.TwoDimensionalFilter=function(array){if(array===null){return null;}
var filter=array;filter.isFiltered=function(value){return value.length&&value.length===filter.length&&value[0]===filter[0]&&value[1]===filter[1];};return filter;};dc.filters.RangedTwoDimensionalFilter=function(array){if(array===null){return null;}
var filter=array;var fromBottomLeft;if(filter[0]instanceof Array){fromBottomLeft=[[Math.min(array[0][0],array[1][0]),Math.min(array[0][1],array[1][1])],[Math.max(array[0][0],array[1][0]),Math.max(array[0][1],array[1][1])]];}else{fromBottomLeft=[[array[0],-Infinity],[array[1],Infinity]];}
filter.isFiltered=function(value){var x,y;if(value instanceof Array){if(value.length!==2){return false;}
x=value[0];y=value[1];}else{x=value;y=fromBottomLeft[0][1];}
return x>=fromBottomLeft[0][0]&&x<fromBottomLeft[1][0]&&y>=fromBottomLeft[0][1]&&y<fromBottomLeft[1][1];};return filter;};dc.baseMixin=function(_chart){_chart.__dcFlag__=dc.utils.uniqueId();var _dimension;var _group;var _anchor;var _root;var _svg;var _isChild;var _minWidth=200;var _defaultWidth=function(element){var width=element&&element.getBoundingClientRect&&element.getBoundingClientRect().width;return(width&&width>_minWidth)?width:_minWidth;};var _width=_defaultWidth;var _minHeight=200;var _defaultHeight=function(element){var height=element&&element.getBoundingClientRect&&element.getBoundingClientRect().height;return(height&&height>_minHeight)?height:_minHeight;};var _height=_defaultHeight;var _keyAccessor=dc.pluck('key');var _valueAccessor=dc.pluck('value');var _label=dc.pluck('key');var _ordering=dc.pluck('key');var _orderSort;var _renderLabel=false;var _title=function(d){return _chart.keyAccessor()(d)+': '+_chart.valueAccessor()(d);};var _renderTitle=true;var _transitionDuration=750;var _filterPrinter=dc.printers.filters;var _mandatoryAttributes=['dimension','group'];var _chartGroup=dc.constants.DEFAULT_CHART_GROUP;var _listeners=d3.dispatch('preRender','postRender','preRedraw','postRedraw','filtered','zoomed','renderlet');var _legend;var _filters=[];var _filterHandler=function(dimension,filters){dimension.filter(null);if(filters.length===0){dimension.filter(null);}else{dimension.filterFunction(function(d){for(var i=0;i<filters.length;i++){var filter=filters[i];if(filter.isFiltered&&filter.isFiltered(d)){return true;}else if(filter<=d&&filter>=d){return true;}}
return false;});}
return filters;};var _data=function(group){return group.all();};_chart.width=function(w){if(!arguments.length){return _width(_root.node());}
_width=d3.functor(w||_defaultWidth);return _chart;};_chart.height=function(h){if(!arguments.length){return _height(_root.node());}
_height=d3.functor(h||_defaultHeight);return _chart;};_chart.minWidth=function(w){if(!arguments.length){return _minWidth;}
_minWidth=w;return _chart;};_chart.minHeight=function(w){if(!arguments.length){return _minHeight;}
_minHeight=w;return _chart;};_chart.dimension=function(d){if(!arguments.length){return _dimension;}
_dimension=d;_chart.expireCache();return _chart;};_chart.data=function(d){if(!arguments.length){return _data.call(_chart,_group);}
_data=d3.functor(d);_chart.expireCache();return _chart;};_chart.group=function(g,name){if(!arguments.length){return _group;}
_group=g;_chart._groupName=name;_chart.expireCache();return _chart;};_chart.ordering=function(o){if(!arguments.length){return _ordering;}
_ordering=o;_orderSort=crossfilter.quicksort.by(_ordering);_chart.expireCache();return _chart;};_chart._computeOrderedGroups=function(data){var dataCopy=data.slice(0);if(dataCopy.length<=1){return dataCopy;}
if(!_orderSort){_orderSort=crossfilter.quicksort.by(_ordering);}
return _orderSort(dataCopy,0,dataCopy.length);};_chart.filterAll=function(){return _chart.filter(null);};_chart.select=function(s){return _root.select(s);};_chart.selectAll=function(s){return _root?_root.selectAll(s):null;};_chart.anchor=function(a,chartGroup){if(!arguments.length){return _anchor;}
if(dc.instanceOfChart(a)){_anchor=a.anchor();_root=a.root();_isChild=true;}else{_anchor=a;_root=d3.select(_anchor);_root.classed(dc.constants.CHART_CLASS,true);dc.registerChart(_chart,chartGroup);_isChild=false;}
_chartGroup=chartGroup;return _chart;};_chart.anchorName=function(){var a=_chart.anchor();if(a&&a.id){return a.id;}
if(a&&a.replace){return a.replace('#','');}
return'dc-chart'+_chart.chartID();};_chart.root=function(r){if(!arguments.length){return _root;}
_root=r;return _chart;};_chart.svg=function(_){if(!arguments.length){return _svg;}
_svg=_;return _chart;};_chart.resetSvg=function(){_chart.select('svg').remove();return generateSvg();};function generateSvg(){_svg=_chart.root().append('svg').attr('width',_chart.width()).attr('height',_chart.height());return _svg;}
_chart.filterPrinter=function(_){if(!arguments.length){return _filterPrinter;}
_filterPrinter=_;return _chart;};_chart.turnOnControls=function(){if(_root){_chart.selectAll('.reset').style('display',null);_chart.selectAll('.filter').text(_filterPrinter(_chart.filters())).style('display',null);}
return _chart;};_chart.turnOffControls=function(){if(_root){_chart.selectAll('.reset').style('display','none');_chart.selectAll('.filter').style('display','none').text(_chart.filter());}
return _chart;};_chart.transitionDuration=function(d){if(!arguments.length){return _transitionDuration;}
_transitionDuration=d;return _chart;};_chart._mandatoryAttributes=function(_){if(!arguments.length){return _mandatoryAttributes;}
_mandatoryAttributes=_;return _chart;};function checkForMandatoryAttributes(a){if(!_chart[a]||!_chart[a]()){throw new dc.errors.InvalidStateException('Mandatory attribute chart.'+a+' is missing on chart[#'+_chart.anchorName()+']');}}
_chart.render=function(){_listeners.preRender(_chart);if(_mandatoryAttributes){_mandatoryAttributes.forEach(checkForMandatoryAttributes);}
var result=_chart._doRender();if(_legend){_legend.render();}
_chart._activateRenderlets('postRender');return result;};_chart._activateRenderlets=function(event){if(_chart.transitionDuration()>0&&_svg){_svg.transition().duration(_chart.transitionDuration()).each('end',function(){_listeners['renderlet'](_chart);if(event){_listeners[event](_chart);}});}else{_listeners['renderlet'](_chart);if(event){_listeners[event](_chart);}}};_chart.redraw=function(){_listeners.preRedraw(_chart);var result=_chart._doRedraw();if(_legend){_legend.render();}
_chart._activateRenderlets('postRedraw');return result;};_chart.redrawGroup=function(){dc.redrawAll(_chart.chartGroup());};_chart.renderGroup=function(){dc.renderAll(_chart.chartGroup());};_chart._invokeFilteredListener=function(f){if(f!==undefined){_listeners.filtered(_chart,f);}};_chart._invokeZoomedListener=function(){_listeners.zoomed(_chart);};var _hasFilterHandler=function(filters,filter){if(filter===null||typeof(filter)==='undefined'){return filters.length>0;}
return filters.some(function(f){return filter<=f&&filter>=f;});};_chart.hasFilterHandler=function(_){if(!arguments.length){return _hasFilterHandler;}
_hasFilterHandler=_;return _chart;};_chart.hasFilter=function(filter){return _hasFilterHandler(_filters,filter);};var _removeFilterHandler=function(filters,filter){for(var i=0;i<filters.length;i++){if(filters[i]<=filter&&filters[i]>=filter){filters.splice(i,1);break;}}
return filters;};_chart.removeFilterHandler=function(_){if(!arguments.length){return _removeFilterHandler;}
_removeFilterHandler=_;return _chart;};var _addFilterHandler=function(filters,filter){filters.push(filter);return filters;};_chart.addFilterHandler=function(_){if(!arguments.length){return _addFilterHandler;}
_addFilterHandler=_;return _chart;};var _resetFilterHandler=function(filters){return[];};_chart.resetFilterHandler=function(_){if(!arguments.length){return _resetFilterHandler;}
_resetFilterHandler=_;return _chart;};function applyFilters(){if(_chart.dimension()&&_chart.dimension().filter){var fs=_filterHandler(_chart.dimension(),_filters);_filters=fs?fs:_filters;}}
_chart.replaceFilter=function(_){_filters=[];_chart.filter(_);};_chart.filter=function(_){if(!arguments.length){return _filters.length>0?_filters[0]:null;}
if(_ instanceof Array&&_[0]instanceof Array&&!_.isFiltered){_[0].forEach(function(d){if(_chart.hasFilter(d)){_removeFilterHandler(_filters,d);}else{_addFilterHandler(_filters,d);}});}else if(_===null){_filters=_resetFilterHandler(_filters);}else{if(_chart.hasFilter(_)){_removeFilterHandler(_filters,_);}else{_addFilterHandler(_filters,_);}}
applyFilters();_chart._invokeFilteredListener(_);if(_root!==null&&_chart.hasFilter()){_chart.turnOnControls();}else{_chart.turnOffControls();}
return _chart;};_chart.filters=function(){return _filters;};_chart.highlightSelected=function(e){d3.select(e).classed(dc.constants.SELECTED_CLASS,true);d3.select(e).classed(dc.constants.DESELECTED_CLASS,false);};_chart.fadeDeselected=function(e){d3.select(e).classed(dc.constants.SELECTED_CLASS,false);d3.select(e).classed(dc.constants.DESELECTED_CLASS,true);};_chart.resetHighlight=function(e){d3.select(e).classed(dc.constants.SELECTED_CLASS,false);d3.select(e).classed(dc.constants.DESELECTED_CLASS,false);};_chart.onClick=function(d){var filter=_chart.keyAccessor()(d);dc.events.trigger(function(){_chart.filter(filter);_chart.redrawGroup();});};_chart.filterHandler=function(_){if(!arguments.length){return _filterHandler;}
_filterHandler=_;return _chart;};_chart._doRender=function(){return _chart;};_chart._doRedraw=function(){return _chart;};_chart.legendables=function(){return[];};_chart.legendHighlight=function(){};_chart.legendReset=function(){};_chart.legendToggle=function(){};_chart.isLegendableHidden=function(){return false;};_chart.keyAccessor=function(_){if(!arguments.length){return _keyAccessor;}
_keyAccessor=_;return _chart;};_chart.valueAccessor=function(_){if(!arguments.length){return _valueAccessor;}
_valueAccessor=_;return _chart;};_chart.label=function(_){if(!arguments.length){return _label;}
_label=_;_renderLabel=true;return _chart;};_chart.renderLabel=function(_){if(!arguments.length){return _renderLabel;}
_renderLabel=_;return _chart;};_chart.title=function(_){if(!arguments.length){return _title;}
_title=_;return _chart;};_chart.renderTitle=function(_){if(!arguments.length){return _renderTitle;}
_renderTitle=_;return _chart;};_chart.renderlet=dc.logger.deprecate(function(_){_chart.on('renderlet.'+dc.utils.uniqueId(),_);return _chart;},'chart.renderlet has been deprecated.  Please use chart.on("renderlet.<renderletKey>", renderletFunction)');_chart.chartGroup=function(_){if(!arguments.length){return _chartGroup;}
if(!_isChild){dc.deregisterChart(_chart,_chartGroup);}
_chartGroup=_;if(!_isChild){dc.registerChart(_chart,_chartGroup);}
return _chart;};_chart.expireCache=function(){return _chart;};_chart.legend=function(l){if(!arguments.length){return _legend;}
_legend=l;_legend.parent(_chart);return _chart;};_chart.chartID=function(){return _chart.__dcFlag__;};_chart.options=function(opts){for(var o in opts){if(typeof(_chart[o])==='function'){_chart[o].call(_chart,opts[o]);}else{dc.logger.debug('Not a valid option setter name: '+o);}}
return _chart;};_chart.on=function(event,listener){_listeners.on(event,listener);return _chart;};return _chart;};dc.marginMixin=function(_chart){var _margin={top:10,right:50,bottom:30,left:30};_chart.margins=function(m){if(!arguments.length){return _margin;}
_margin=m;return _chart;};_chart.effectiveWidth=function(){return _chart.width()-_chart.margins().left-_chart.margins().right;};_chart.effectiveHeight=function(){return _chart.height()-_chart.margins().top-_chart.margins().bottom;};return _chart;};dc.colorMixin=function(_chart){var _colors=d3.scale.category20c();var _defaultAccessor=true;var _colorAccessor=function(d){return _chart.keyAccessor()(d);};_chart.colors=function(_){if(!arguments.length){return _colors;}
if(_ instanceof Array){_colors=d3.scale.quantize().range(_);}else{_colors=d3.functor(_);}
return _chart;};_chart.ordinalColors=function(r){return _chart.colors(d3.scale.ordinal().range(r));};_chart.linearColors=function(r){return _chart.colors(d3.scale.linear().range(r).interpolate(d3.interpolateHcl));};_chart.colorAccessor=function(_){if(!arguments.length){return _colorAccessor;}
_colorAccessor=_;_defaultAccessor=false;return _chart;};_chart.defaultColorAccessor=function(){return _defaultAccessor;};_chart.colorDomain=function(_){if(!arguments.length){return _colors.domain();}
_colors.domain(_);return _chart;};_chart.calculateColorDomain=function(){var newDomain=[d3.min(_chart.data(),_chart.colorAccessor()),d3.max(_chart.data(),_chart.colorAccessor())];_colors.domain(newDomain);return _chart;};_chart.getColor=function(d,i){return _colors(_colorAccessor.call(this,d,i));};_chart.colorCalculator=function(_){if(!arguments.length){return _chart.getColor;}
_chart.getColor=_;return _chart;};return _chart;};dc.coordinateGridMixin=function(_chart){var GRID_LINE_CLASS='grid-line';var HORIZONTAL_CLASS='horizontal';var VERTICAL_CLASS='vertical';var Y_AXIS_LABEL_CLASS='y-axis-label';var X_AXIS_LABEL_CLASS='x-axis-label';var DEFAULT_AXIS_LABEL_PADDING=12;_chart=dc.colorMixin(dc.marginMixin(dc.baseMixin(_chart)));_chart.colors(d3.scale.category10());_chart._mandatoryAttributes().push('x');function zoomHandler(){_refocused=true;if(_zoomOutRestrict){_chart.x().domain(constrainRange(_chart.x().domain(),_xOriginalDomain));if(_rangeChart){_chart.x().domain(constrainRange(_chart.x().domain(),_rangeChart.x().domain()));}}
var domain=_chart.x().domain();var domFilter=dc.filters.RangedFilter(domain[0],domain[1]);_chart.replaceFilter(domFilter);_chart.rescale();_chart.redraw();if(_rangeChart&&!rangesEqual(_chart.filter(),_rangeChart.filter())){dc.events.trigger(function(){_rangeChart.replaceFilter(domFilter);_rangeChart.redraw();});}
_chart._invokeZoomedListener();dc.events.trigger(function(){_chart.redrawGroup();},dc.constants.EVENT_DELAY);_refocused=!rangesEqual(domain,_xOriginalDomain);}
var _parent;var _g;var _chartBodyG;var _x;var _xOriginalDomain;var _xAxis=d3.svg.axis().orient('bottom');var _xUnits=dc.units.integers;var _xAxisPadding=0;var _xElasticity=false;var _xAxisLabel;var _xAxisLabelPadding=0;var _lastXDomain;var _y;var _yAxis=d3.svg.axis().orient('left');var _yAxisPadding=0;var _yElasticity=false;var _yAxisLabel;var _yAxisLabelPadding=0;var _brush=d3.svg.brush();var _brushOn=true;var _round;var _renderHorizontalGridLine=false;var _renderVerticalGridLine=false;var _refocused=false;var _unitCount;var _zoomScale=[1,Infinity];var _zoomOutRestrict=true;var _zoom=d3.behavior.zoom().on('zoom',zoomHandler);var _nullZoom=d3.behavior.zoom().on('zoom',null);var _hasBeenMouseZoomable=false;var _rangeChart;var _focusChart;var _mouseZoomable=false;var _clipPadding=0;var _outerRangeBandPadding=0.5;var _rangeBandPadding=0;var _useRightYAxis=false;_chart.rescale=function(){_unitCount=undefined;};_chart.rangeChart=function(_){if(!arguments.length){return _rangeChart;}
_rangeChart=_;_rangeChart.focusChart(_chart);return _chart;};_chart.zoomScale=function(_){if(!arguments.length){return _zoomScale;}
_zoomScale=_;return _chart;};_chart.zoomOutRestrict=function(r){if(!arguments.length){return _zoomOutRestrict;}
_zoomScale[0]=r?1:0;_zoomOutRestrict=r;return _chart;};_chart._generateG=function(parent){if(parent===undefined){_parent=_chart.svg();}else{_parent=parent;}
_g=_parent.append('g');_chartBodyG=_g.append('g').attr('class','chart-body').attr('transform','translate('+_chart.margins().left+', '+_chart.margins().top+')').attr('clip-path','url(#'+getClipPathId()+')');return _g;};_chart.g=function(_){if(!arguments.length){return _g;}
_g=_;return _chart;};_chart.mouseZoomable=function(z){if(!arguments.length){return _mouseZoomable;}
_mouseZoomable=z;return _chart;};_chart.chartBodyG=function(_){if(!arguments.length){return _chartBodyG;}
_chartBodyG=_;return _chart;};_chart.x=function(_){if(!arguments.length){return _x;}
_x=_;_xOriginalDomain=_x.domain();return _chart;};_chart.xOriginalDomain=function(){return _xOriginalDomain;};_chart.xUnits=function(_){if(!arguments.length){return _xUnits;}
_xUnits=_;return _chart;};_chart.xAxis=function(_){if(!arguments.length){return _xAxis;}
_xAxis=_;return _chart;};_chart.elasticX=function(_){if(!arguments.length){return _xElasticity;}
_xElasticity=_;return _chart;};_chart.xAxisPadding=function(_){if(!arguments.length){return _xAxisPadding;}
_xAxisPadding=_;return _chart;};_chart.xUnitCount=function(){if(_unitCount===undefined){var units=_chart.xUnits()(_chart.x().domain()[0],_chart.x().domain()[1],_chart.x().domain());if(units instanceof Array){_unitCount=units.length;}else{_unitCount=units;}}
return _unitCount;};_chart.useRightYAxis=function(_){if(!arguments.length){return _useRightYAxis;}
_useRightYAxis=_;return _chart;};_chart.isOrdinal=function(){return _chart.xUnits()===dc.units.ordinal;};_chart._useOuterPadding=function(){return true;};_chart._ordinalXDomain=function(){var groups=_chart._computeOrderedGroups(_chart.data());return groups.map(_chart.keyAccessor());};function prepareXAxis(g){if(!_chart.isOrdinal()){if(_chart.elasticX()){_x.domain([_chart.xAxisMin(),_chart.xAxisMax()]);}}
else{if(_chart.elasticX()||_x.domain().length===0){_x.domain(_chart._ordinalXDomain());}}
var xdom=_x.domain();if(!_lastXDomain||xdom.some(function(elem,i){return elem!==_lastXDomain[i];})){_chart.rescale();}
_lastXDomain=xdom;if(_chart.isOrdinal()){_x.rangeBands([0,_chart.xAxisLength()],_rangeBandPadding,_chart._useOuterPadding()?_outerRangeBandPadding:0);}else{_x.range([0,_chart.xAxisLength()]);}
_xAxis=_xAxis.scale(_chart.x());renderVerticalGridLines(g);}
_chart.renderXAxis=function(g){var axisXG=g.selectAll('g.x');if(axisXG.empty()){axisXG=g.append('g').attr('class','axis x').attr('transform','translate('+_chart.margins().left+','+_chart._xAxisY()+')');}
var axisXLab=g.selectAll('text.'+X_AXIS_LABEL_CLASS);if(axisXLab.empty()&&_chart.xAxisLabel()){axisXLab=g.append('text').attr('transform','translate('+(_chart.margins().left+_chart.xAxisLength()/2)+','+(_chart.height()-_xAxisLabelPadding)+')').attr('class',X_AXIS_LABEL_CLASS).attr('text-anchor','middle').text(_chart.xAxisLabel());}
if(_chart.xAxisLabel()&&axisXLab.text()!==_chart.xAxisLabel()){axisXLab.text(_chart.xAxisLabel());}
dc.transition(axisXG,_chart.transitionDuration()).call(_xAxis);};function renderVerticalGridLines(g){var gridLineG=g.selectAll('g.'+VERTICAL_CLASS);if(_renderVerticalGridLine){if(gridLineG.empty()){gridLineG=g.insert('g',':first-child').attr('class',GRID_LINE_CLASS+' '+VERTICAL_CLASS).attr('transform','translate('+_chart.margins().left+','+_chart.margins().top+')');}
var ticks=_xAxis.tickValues()?_xAxis.tickValues():(typeof _x.ticks==='function'?_x.ticks(_xAxis.ticks()[0]):_x.domain());var lines=gridLineG.selectAll('line').data(ticks);var linesGEnter=lines.enter().append('line').attr('x1',function(d){return _x(d);}).attr('y1',_chart._xAxisY()-_chart.margins().top).attr('x2',function(d){return _x(d);}).attr('y2',0).attr('opacity',0);dc.transition(linesGEnter,_chart.transitionDuration()).attr('opacity',1);dc.transition(lines,_chart.transitionDuration()).attr('x1',function(d){return _x(d);}).attr('y1',_chart._xAxisY()-_chart.margins().top).attr('x2',function(d){return _x(d);}).attr('y2',0);lines.exit().remove();}
else{gridLineG.selectAll('line').remove();}}
_chart._xAxisY=function(){return(_chart.height()-_chart.margins().bottom);};_chart.xAxisLength=function(){return _chart.effectiveWidth();};_chart.xAxisLabel=function(_,padding){if(!arguments.length){return _xAxisLabel;}
_xAxisLabel=_;_chart.margins().bottom-=_xAxisLabelPadding;_xAxisLabelPadding=(padding===undefined)?DEFAULT_AXIS_LABEL_PADDING:padding;_chart.margins().bottom+=_xAxisLabelPadding;return _chart;};_chart._prepareYAxis=function(g){if(_y===undefined||_chart.elasticY()){_y=d3.scale.linear();var min=_chart.yAxisMin()||0,max=_chart.yAxisMax()||0;_y.domain([min,max]).rangeRound([_chart.yAxisHeight(),0]);}
_y.range([_chart.yAxisHeight(),0]);_yAxis=_yAxis.scale(_y);if(_useRightYAxis){_yAxis.orient('right');}
_chart._renderHorizontalGridLinesForAxis(g,_y,_yAxis);};_chart.renderYAxisLabel=function(axisClass,text,rotation,labelXPosition){labelXPosition=labelXPosition||_yAxisLabelPadding;var axisYLab=_chart.g().selectAll('text.'+Y_AXIS_LABEL_CLASS+'.'+axisClass+'-label');if(axisYLab.empty()&&text){var labelYPosition=(_chart.margins().top+_chart.yAxisHeight()/2);axisYLab=_chart.g().append('text').attr('transform','translate('+labelXPosition+','+labelYPosition+'),rotate('+rotation+')').attr('class',Y_AXIS_LABEL_CLASS+' '+axisClass+'-label').attr('text-anchor','middle').text(text);}
if(text&&axisYLab.text()!==text){axisYLab.text(text);}};_chart.renderYAxisAt=function(axisClass,axis,position){var axisYG=_chart.g().selectAll('g.'+axisClass);if(axisYG.empty()){axisYG=_chart.g().append('g').attr('class','axis '+axisClass).attr('transform','translate('+position+','+_chart.margins().top+')');}
dc.transition(axisYG,_chart.transitionDuration()).call(axis);};_chart.renderYAxis=function(){var axisPosition=_useRightYAxis?(_chart.width()-_chart.margins().right):_chart._yAxisX();_chart.renderYAxisAt('y',_yAxis,axisPosition);var labelPosition=_useRightYAxis?(_chart.width()-_yAxisLabelPadding):_yAxisLabelPadding;var rotation=_useRightYAxis?90:-90;_chart.renderYAxisLabel('y',_chart.yAxisLabel(),rotation,labelPosition);};_chart._renderHorizontalGridLinesForAxis=function(g,scale,axis){var gridLineG=g.selectAll('g.'+HORIZONTAL_CLASS);if(_renderHorizontalGridLine){var ticks=axis.tickValues()?axis.tickValues():scale.ticks(axis.ticks()[0]);if(gridLineG.empty()){gridLineG=g.insert('g',':first-child').attr('class',GRID_LINE_CLASS+' '+HORIZONTAL_CLASS).attr('transform','translate('+_chart.margins().left+','+_chart.margins().top+')');}
var lines=gridLineG.selectAll('line').data(ticks);var linesGEnter=lines.enter().append('line').attr('x1',1).attr('y1',function(d){return scale(d);}).attr('x2',_chart.xAxisLength()).attr('y2',function(d){return scale(d);}).attr('opacity',0);dc.transition(linesGEnter,_chart.transitionDuration()).attr('opacity',1);dc.transition(lines,_chart.transitionDuration()).attr('x1',1).attr('y1',function(d){return scale(d);}).attr('x2',_chart.xAxisLength()).attr('y2',function(d){return scale(d);});lines.exit().remove();}
else{gridLineG.selectAll('line').remove();}};_chart._yAxisX=function(){return _chart.useRightYAxis()?_chart.width()-_chart.margins().right:_chart.margins().left;};_chart.yAxisLabel=function(_,padding){if(!arguments.length){return _yAxisLabel;}
_yAxisLabel=_;_chart.margins().left-=_yAxisLabelPadding;_yAxisLabelPadding=(padding===undefined)?DEFAULT_AXIS_LABEL_PADDING:padding;_chart.margins().left+=_yAxisLabelPadding;return _chart;};_chart.y=function(_){if(!arguments.length){return _y;}
_y=_;return _chart;};_chart.yAxis=function(y){if(!arguments.length){return _yAxis;}
_yAxis=y;return _chart;};_chart.elasticY=function(_){if(!arguments.length){return _yElasticity;}
_yElasticity=_;return _chart;};_chart.renderHorizontalGridLines=function(_){if(!arguments.length){return _renderHorizontalGridLine;}
_renderHorizontalGridLine=_;return _chart;};_chart.renderVerticalGridLines=function(_){if(!arguments.length){return _renderVerticalGridLine;}
_renderVerticalGridLine=_;return _chart;};_chart.xAxisMin=function(){var min=d3.min(_chart.data(),function(e){return _chart.keyAccessor()(e);});return dc.utils.subtract(min,_xAxisPadding);};_chart.xAxisMax=function(){var max=d3.max(_chart.data(),function(e){return _chart.keyAccessor()(e);});return dc.utils.add(max,_xAxisPadding);};_chart.yAxisMin=function(){var min=d3.min(_chart.data(),function(e){return _chart.valueAccessor()(e);});return dc.utils.subtract(min,_yAxisPadding);};_chart.yAxisMax=function(){var max=d3.max(_chart.data(),function(e){return _chart.valueAccessor()(e);});return dc.utils.add(max,_yAxisPadding);};_chart.yAxisPadding=function(_){if(!arguments.length){return _yAxisPadding;}
_yAxisPadding=_;return _chart;};_chart.yAxisHeight=function(){return _chart.effectiveHeight();};_chart.round=function(_){if(!arguments.length){return _round;}
_round=_;return _chart;};_chart._rangeBandPadding=function(_){if(!arguments.length){return _rangeBandPadding;}
_rangeBandPadding=_;return _chart;};_chart._outerRangeBandPadding=function(_){if(!arguments.length){return _outerRangeBandPadding;}
_outerRangeBandPadding=_;return _chart;};dc.override(_chart,'filter',function(_){if(!arguments.length){return _chart._filter();}
_chart._filter(_);if(_){_chart.brush().extent(_);}else{_chart.brush().clear();}
return _chart;});_chart.brush=function(_){if(!arguments.length){return _brush;}
_brush=_;return _chart;};function brushHeight(){return _chart._xAxisY()-_chart.margins().top;}
_chart.renderBrush=function(g){if(_brushOn){_brush.on('brush',_chart._brushing);_brush.on('brushstart',_chart._disableMouseZoom);_brush.on('brushend',configureMouseZoom);var gBrush=g.append('g').attr('class','brush').attr('transform','translate('+_chart.margins().left+','+_chart.margins().top+')').call(_brush.x(_chart.x()));_chart.setBrushY(gBrush);_chart.setHandlePaths(gBrush);if(_chart.hasFilter()){_chart.redrawBrush(g);}}};_chart.setHandlePaths=function(gBrush){gBrush.selectAll('.resize').append('path').attr('d',_chart.resizeHandlePath);};_chart.setBrushY=function(gBrush){gBrush.selectAll('rect').attr('height',brushHeight());};_chart.extendBrush=function(){var extent=_brush.extent();if(_chart.round()){extent[0]=extent.map(_chart.round())[0];extent[1]=extent.map(_chart.round())[1];_g.select('.brush').call(_brush.extent(extent));}
return extent;};_chart.brushIsEmpty=function(extent){return _brush.empty()||!extent||extent[1]<=extent[0];};_chart._brushing=function(){var extent=_chart.extendBrush();_chart.redrawBrush(_g);if(_chart.brushIsEmpty(extent)){dc.events.trigger(function(){_chart.filter(null);_chart.redrawGroup();},dc.constants.EVENT_DELAY);}else{var rangedFilter=dc.filters.RangedFilter(extent[0],extent[1]);dc.events.trigger(function(){_chart.replaceFilter(rangedFilter);_chart.redrawGroup();},dc.constants.EVENT_DELAY);}};_chart.redrawBrush=function(g){if(_brushOn){if(_chart.filter()&&_chart.brush().empty()){_chart.brush().extent(_chart.filter());}
var gBrush=g.select('g.brush');gBrush.call(_chart.brush().x(_chart.x()));_chart.setBrushY(gBrush);}
_chart.fadeDeselectedArea();};_chart.fadeDeselectedArea=function(){};_chart.resizeHandlePath=function(d){var e=+(d==='e'),x=e?1:-1,y=brushHeight()/3;return'M'+(0.5*x)+','+y+'A6,6 0 0 '+e+' '+(6.5*x)+','+(y+6)+'V'+(2*y-6)+'A6,6 0 0 '+e+' '+(0.5*x)+','+(2*y)+'Z'+'M'+(2.5*x)+','+(y+8)+'V'+(2*y-8)+'M'+(4.5*x)+','+(y+8)+'V'+(2*y-8);};function getClipPathId(){return _chart.anchorName().replace(/[ .#]/g,'-')+'-clip';}
_chart.clipPadding=function(p){if(!arguments.length){return _clipPadding;}
_clipPadding=p;return _chart;};function generateClipPath(){var defs=dc.utils.appendOrSelect(_parent,'defs');var id=getClipPathId();var chartBodyClip=dc.utils.appendOrSelect(defs,'#'+id,'clipPath').attr('id',id);var padding=_clipPadding*2;dc.utils.appendOrSelect(chartBodyClip,'rect').attr('width',_chart.xAxisLength()+padding).attr('height',_chart.yAxisHeight()+padding).attr('transform','translate(-'+_clipPadding+', -'+_clipPadding+')');}
_chart._preprocessData=function(){};_chart._doRender=function(){_chart.resetSvg();_chart._preprocessData();_chart._generateG();generateClipPath();drawChart(true);configureMouseZoom();return _chart;};_chart._doRedraw=function(){_chart._preprocessData();drawChart(false);generateClipPath();return _chart;};function drawChart(render){if(_chart.isOrdinal()){_brushOn=false;}
prepareXAxis(_chart.g());_chart._prepareYAxis(_chart.g());_chart.plotData();if(_chart.elasticX()||_refocused||render){_chart.renderXAxis(_chart.g());}
if(_chart.elasticY()||render){_chart.renderYAxis(_chart.g());}
if(render){_chart.renderBrush(_chart.g());}else{_chart.redrawBrush(_chart.g());}}
function configureMouseZoom(){if(_mouseZoomable){_chart._enableMouseZoom();}
else if(_hasBeenMouseZoomable){_chart._disableMouseZoom();}}
_chart._enableMouseZoom=function(){_hasBeenMouseZoomable=true;_zoom.x(_chart.x()).scaleExtent(_zoomScale).size([_chart.width(),_chart.height()]).duration(_chart.transitionDuration());_chart.root().call(_zoom);};_chart._disableMouseZoom=function(){_chart.root().call(_nullZoom);};function constrainRange(range,constraint){var constrainedRange=[];constrainedRange[0]=d3.max([range[0],constraint[0]]);constrainedRange[1]=d3.min([range[1],constraint[1]]);return constrainedRange;}
_chart.focus=function(range){if(hasRangeSelected(range)){_chart.x().domain(range);}else{_chart.x().domain(_xOriginalDomain);}
_zoom.x(_chart.x());zoomHandler();};_chart.refocused=function(){return _refocused;};_chart.focusChart=function(c){if(!arguments.length){return _focusChart;}
_focusChart=c;_chart.on('filtered',function(chart){if(!chart.filter()){dc.events.trigger(function(){_focusChart.x().domain(_focusChart.xOriginalDomain());});}else if(!rangesEqual(chart.filter(),_focusChart.filter())){dc.events.trigger(function(){_focusChart.focus(chart.filter());});}});return _chart;};function rangesEqual(range1,range2){if(!range1&&!range2){return true;}
else if(!range1||!range2){return false;}
else if(range1.length===0&&range2.length===0){return true;}
else if(range1[0].valueOf()===range2[0].valueOf()&&range1[1].valueOf()===range2[1].valueOf()){return true;}
return false;}
_chart.brushOn=function(_){if(!arguments.length){return _brushOn;}
_brushOn=_;return _chart;};function hasRangeSelected(range){return range instanceof Array&&range.length>1;}
return _chart;};dc.stackMixin=function(_chart){function prepareValues(layer,layerIdx){var valAccessor=layer.accessor||_chart.valueAccessor();layer.name=String(layer.name||layerIdx);layer.values=layer.group.all().map(function(d,i){return{x:_chart.keyAccessor()(d,i),y:layer.hidden?null:valAccessor(d,i),data:d,layer:layer.name,hidden:layer.hidden};});layer.values=layer.values.filter(domainFilter());return layer.values;}
var _stackLayout=d3.layout.stack().values(prepareValues);var _stack=[];var _titles={};var _hidableStacks=false;function domainFilter(){if(!_chart.x()){return d3.functor(true);}
var xDomain=_chart.x().domain();if(_chart.isOrdinal()){return function(){return true;};}
if(_chart.elasticX()){return function(){return true;};}
return function(p){return p.x>=xDomain[0]&&p.x<=xDomain[xDomain.length-1];};}
_chart.stack=function(group,name,accessor){if(!arguments.length){return _stack;}
if(arguments.length<=2){accessor=name;}
var layer={group:group};if(typeof name==='string'){layer.name=name;}
if(typeof accessor==='function'){layer.accessor=accessor;}
_stack.push(layer);return _chart;};dc.override(_chart,'group',function(g,n,f){if(!arguments.length){return _chart._group();}
_stack=[];_titles={};_chart.stack(g,n);if(f){_chart.valueAccessor(f);}
return _chart._group(g,n);});_chart.hidableStacks=function(_){if(!arguments.length){return _hidableStacks;}
_hidableStacks=_;return _chart;};function findLayerByName(n){var i=_stack.map(dc.pluck('name')).indexOf(n);return _stack[i];}
_chart.hideStack=function(stackName){var layer=findLayerByName(stackName);if(layer){layer.hidden=true;}
return _chart;};_chart.showStack=function(stackName){var layer=findLayerByName(stackName);if(layer){layer.hidden=false;}
return _chart;};_chart.getValueAccessorByIndex=function(index){return _stack[index].accessor||_chart.valueAccessor();};_chart.yAxisMin=function(){var min=d3.min(flattenStack(),function(p){return(p.y+p.y0<p.y0)?(p.y+p.y0):p.y0;});return dc.utils.subtract(min,_chart.yAxisPadding());};_chart.yAxisMax=function(){var max=d3.max(flattenStack(),function(p){return p.y+p.y0;});return dc.utils.add(max,_chart.yAxisPadding());};function flattenStack(){var valueses=_chart.data().map(function(layer){return layer.values;});return Array.prototype.concat.apply([],valueses);}
_chart.xAxisMin=function(){var min=d3.min(flattenStack(),dc.pluck('x'));return dc.utils.subtract(min,_chart.xAxisPadding());};_chart.xAxisMax=function(){var max=d3.max(flattenStack(),dc.pluck('x'));return dc.utils.add(max,_chart.xAxisPadding());};dc.override(_chart,'title',function(stackName,titleAccessor){if(!stackName){return _chart._title();}
if(typeof stackName==='function'){return _chart._title(stackName);}
if(stackName===_chart._groupName&&typeof titleAccessor==='function'){return _chart._title(titleAccessor);}
if(typeof titleAccessor!=='function'){return _titles[stackName]||_chart._title();}
_titles[stackName]=titleAccessor;return _chart;});_chart.stackLayout=function(stack){if(!arguments.length){return _stackLayout;}
_stackLayout=stack;return _chart;};function visability(l){return!l.hidden;}
_chart.data(function(){var layers=_stack.filter(visability);return layers.length?_chart.stackLayout()(layers):[];});_chart._ordinalXDomain=function(){var flat=flattenStack().map(dc.pluck('data'));var ordered=_chart._computeOrderedGroups(flat);return ordered.map(_chart.keyAccessor());};_chart.colorAccessor(function(d){var layer=this.layer||this.name||d.name||d.layer;return layer;});_chart.legendables=function(){return _stack.map(function(layer,i){return{chart:_chart,name:layer.name,hidden:layer.hidden||false,color:_chart.getColor.call(layer,layer.values,i)};});};_chart.isLegendableHidden=function(d){var layer=findLayerByName(d.name);return layer?layer.hidden:false;};_chart.legendToggle=function(d){if(_hidableStacks){if(_chart.isLegendableHidden(d)){_chart.showStack(d.name);}else{_chart.hideStack(d.name);}
_chart.renderGroup();}};return _chart;};dc.capMixin=function(_chart){var _cap=Infinity;var _othersLabel='Others';var _othersGrouper=function(topRows){var topRowsSum=d3.sum(topRows,_chart.valueAccessor()),allRows=_chart.group().all(),allRowsSum=d3.sum(allRows,_chart.valueAccessor()),topKeys=topRows.map(_chart.keyAccessor()),allKeys=allRows.map(_chart.keyAccessor()),topSet=d3.set(topKeys),others=allKeys.filter(function(d){return!topSet.has(d);});if(allRowsSum>topRowsSum){return topRows.concat([{'others':others,'key':_othersLabel,'value':allRowsSum-topRowsSum}]);}
return topRows;};_chart.cappedKeyAccessor=function(d,i){if(d.others){return d.key;}
return _chart.keyAccessor()(d,i);};_chart.cappedValueAccessor=function(d,i){if(d.others){return d.value;}
return _chart.valueAccessor()(d,i);};_chart.data(function(group){if(_cap===Infinity){return _chart._computeOrderedGroups(group.all());}else{var topRows=group.top(_cap);topRows=_chart._computeOrderedGroups(topRows);if(_othersGrouper){return _othersGrouper(topRows);}
return topRows;}});_chart.cap=function(_){if(!arguments.length){return _cap;}
_cap=_;return _chart;};_chart.othersLabel=function(_){if(!arguments.length){return _othersLabel;}
_othersLabel=_;return _chart;};_chart.othersGrouper=function(_){if(!arguments.length){return _othersGrouper;}
_othersGrouper=_;return _chart;};dc.override(_chart,'onClick',function(d){if(d.others){_chart.filter([d.others]);}
_chart._onClick(d);});return _chart;};dc.bubbleMixin=function(_chart){var _maxBubbleRelativeSize=0.3;var _minRadiusWithLabel=10;_chart.BUBBLE_NODE_CLASS='node';_chart.BUBBLE_CLASS='bubble';_chart.MIN_RADIUS=10;_chart=dc.colorMixin(_chart);_chart.renderLabel(true);_chart.data(function(group){return group.top(Infinity);});var _r=d3.scale.linear().domain([0,100]);var _rValueAccessor=function(d){return d.r;};_chart.r=function(_){if(!arguments.length){return _r;}
_r=_;return _chart;};_chart.radiusValueAccessor=function(_){if(!arguments.length){return _rValueAccessor;}
_rValueAccessor=_;return _chart;};_chart.rMin=function(){var min=d3.min(_chart.data(),function(e){return _chart.radiusValueAccessor()(e);});return min;};_chart.rMax=function(){var max=d3.max(_chart.data(),function(e){return _chart.radiusValueAccessor()(e);});return max;};_chart.bubbleR=function(d){var value=_chart.radiusValueAccessor()(d);var r=_chart.r()(value);if(isNaN(r)||value<=0){r=0;}
return r;};var labelFunction=function(d){return _chart.label()(d);};var labelOpacity=function(d){return(_chart.bubbleR(d)>_minRadiusWithLabel)?1:0;};_chart._doRenderLabel=function(bubbleGEnter){if(_chart.renderLabel()){var label=bubbleGEnter.select('text');if(label.empty()){label=bubbleGEnter.append('text').attr('text-anchor','middle').attr('dy','.3em').on('click',_chart.onClick);}
label.attr('opacity',0).text(labelFunction);dc.transition(label,_chart.transitionDuration()).attr('opacity',labelOpacity);}};_chart.doUpdateLabels=function(bubbleGEnter){if(_chart.renderLabel()){var labels=bubbleGEnter.selectAll('text').text(labelFunction);dc.transition(labels,_chart.transitionDuration()).attr('opacity',labelOpacity);}};var titleFunction=function(d){return _chart.title()(d);};_chart._doRenderTitles=function(g){if(_chart.renderTitle()){var title=g.select('title');if(title.empty()){g.append('title').text(titleFunction);}}};_chart.doUpdateTitles=function(g){if(_chart.renderTitle()){g.selectAll('title').text(titleFunction);}};_chart.minRadiusWithLabel=function(_){if(!arguments.length){return _minRadiusWithLabel;}
_minRadiusWithLabel=_;return _chart;};_chart.maxBubbleRelativeSize=function(_){if(!arguments.length){return _maxBubbleRelativeSize;}
_maxBubbleRelativeSize=_;return _chart;};_chart.fadeDeselectedArea=function(){if(_chart.hasFilter()){_chart.selectAll('g.'+_chart.BUBBLE_NODE_CLASS).each(function(d){if(_chart.isSelectedNode(d)){_chart.highlightSelected(this);}else{_chart.fadeDeselected(this);}});}else{_chart.selectAll('g.'+_chart.BUBBLE_NODE_CLASS).each(function(){_chart.resetHighlight(this);});}};_chart.isSelectedNode=function(d){return _chart.hasFilter(d.key);};_chart.onClick=function(d){var filter=d.key;dc.events.trigger(function(){_chart.filter(filter);_chart.redrawGroup();});};return _chart;};dc.pieChart=function(parent,chartGroup){var DEFAULT_MIN_ANGLE_FOR_LABEL=0.5;var _sliceCssClass='pie-slice';var _emptyCssClass='empty-chart';var _emptyTitle='empty';var _radius,_innerRadius=0;var _g;var _cx;var _cy;var _minAngleForLabel=DEFAULT_MIN_ANGLE_FOR_LABEL;var _externalLabelRadius;var _chart=dc.capMixin(dc.colorMixin(dc.baseMixin({})));_chart.colorAccessor(_chart.cappedKeyAccessor);_chart.title(function(d){return _chart.cappedKeyAccessor(d)+': '+_chart.cappedValueAccessor(d);});_chart.slicesCap=_chart.cap;_chart.label(_chart.cappedKeyAccessor);_chart.renderLabel(true);_chart.transitionDuration(350);_chart._doRender=function(){_chart.resetSvg();_g=_chart.svg().append('g').attr('transform','translate('+_chart.cx()+','+_chart.cy()+')');drawChart();return _chart;};function drawChart(){_radius=_radius?_radius:d3.min([_chart.width(),_chart.height()])/2;var arc=buildArcs();var pie=pieLayout();var pieData;if(d3.sum(_chart.data(),_chart.valueAccessor())){pieData=pie(_chart.data());_g.classed(_emptyCssClass,false);}else{pieData=pie([{key:_emptyTitle,value:1,others:[_emptyTitle]}]);_g.classed(_emptyCssClass,true);}
if(_g){var slices=_g.selectAll('g.'+_sliceCssClass).data(pieData);createElements(slices,arc,pieData);updateElements(pieData,arc);removeElements(slices);highlightFilter();}}
function createElements(slices,arc,pieData){var slicesEnter=createSliceNodes(slices);createSlicePath(slicesEnter,arc);createTitles(slicesEnter);createLabels(pieData,arc);}
function createSliceNodes(slices){var slicesEnter=slices.enter().append('g').attr('class',function(d,i){return _sliceCssClass+' _'+i;});return slicesEnter;}
function createSlicePath(slicesEnter,arc){var slicePath=slicesEnter.append('path').attr('fill',fill).on('click',onClick).attr('d',function(d,i){return safeArc(d,i,arc);});dc.transition(slicePath,_chart.transitionDuration(),function(s){s.attrTween('d',tweenPie);});}
function createTitles(slicesEnter){if(_chart.renderTitle()){slicesEnter.append('title').text(function(d){return _chart.title()(d.data);});}}
function positionLabels(labelsEnter,arc){dc.transition(labelsEnter,_chart.transitionDuration()).attr('transform',function(d){return labelPosition(d,arc);}).attr('text-anchor','middle').text(function(d){var data=d.data;if((sliceHasNoData(data)||sliceTooSmall(d))&&!isSelectedSlice(d)){return'';}
return _chart.label()(d.data);});}
function createLabels(pieData,arc){if(_chart.renderLabel()){var labels=_g.selectAll('text.'+_sliceCssClass).data(pieData);labels.exit().remove();var labelsEnter=labels.enter().append('text').attr('class',function(d,i){var classes=_sliceCssClass+' _'+i;if(_externalLabelRadius){classes+=' external';}
return classes;}).on('click',onClick);positionLabels(labelsEnter,arc);}}
function updateElements(pieData,arc){updateSlicePaths(pieData,arc);updateLabels(pieData,arc);updateTitles(pieData);}
function updateSlicePaths(pieData,arc){var slicePaths=_g.selectAll('g.'+_sliceCssClass).data(pieData).select('path').attr('d',function(d,i){return safeArc(d,i,arc);});dc.transition(slicePaths,_chart.transitionDuration(),function(s){s.attrTween('d',tweenPie);}).attr('fill',fill);}
function updateLabels(pieData,arc){if(_chart.renderLabel()){var labels=_g.selectAll('text.'+_sliceCssClass).data(pieData);positionLabels(labels,arc);}}
function updateTitles(pieData){if(_chart.renderTitle()){_g.selectAll('g.'+_sliceCssClass).data(pieData).select('title').text(function(d){return _chart.title()(d.data);});}}
function removeElements(slices){slices.exit().remove();}
function highlightFilter(){if(_chart.hasFilter()){_chart.selectAll('g.'+_sliceCssClass).each(function(d){if(isSelectedSlice(d)){_chart.highlightSelected(this);}else{_chart.fadeDeselected(this);}});}else{_chart.selectAll('g.'+_sliceCssClass).each(function(){_chart.resetHighlight(this);});}}
_chart.innerRadius=function(r){if(!arguments.length){return _innerRadius;}
_innerRadius=r;return _chart;};_chart.radius=function(r){if(!arguments.length){return _radius;}
_radius=r;return _chart;};_chart.cx=function(cx){if(!arguments.length){return(_cx||_chart.width()/2);}
_cx=cx;return _chart;};_chart.cy=function(cy){if(!arguments.length){return(_cy||_chart.height()/2);}
_cy=cy;return _chart;};function buildArcs(){return d3.svg.arc().outerRadius(_radius).innerRadius(_innerRadius);}
function isSelectedSlice(d){return _chart.hasFilter(_chart.cappedKeyAccessor(d.data));}
_chart._doRedraw=function(){drawChart();return _chart;};_chart.minAngleForLabel=function(_){if(!arguments.length){return _minAngleForLabel;}
_minAngleForLabel=_;return _chart;};function pieLayout(){return d3.layout.pie().sort(null).value(_chart.cappedValueAccessor);}
function sliceTooSmall(d){var angle=(d.endAngle-d.startAngle);return isNaN(angle)||angle<_minAngleForLabel;}
function sliceHasNoData(d){return _chart.cappedValueAccessor(d)===0;}
function tweenPie(b){b.innerRadius=_innerRadius;var current=this._current;if(isOffCanvas(current)){current={startAngle:0,endAngle:0};}
var i=d3.interpolate(current,b);this._current=i(0);return function(t){return safeArc(i(t),0,buildArcs());};}
function isOffCanvas(current){return!current||isNaN(current.startAngle)||isNaN(current.endAngle);}
function fill(d,i){return _chart.getColor(d.data,i);}
function onClick(d,i){if(_g.attr('class')!==_emptyCssClass){_chart.onClick(d.data,i);}}
function safeArc(d,i,arc){var path=arc(d,i);if(path.indexOf('NaN')>=0){path='M0,0';}
return path;}
_chart.emptyTitle=function(title){if(arguments.length===0){return _emptyTitle;}
_emptyTitle=title;return _chart;};_chart.externalLabels=function(radius){if(arguments.length===0){return _externalLabelRadius;}else if(radius){_externalLabelRadius=radius;}else{_externalLabelRadius=undefined;}
return _chart;};function labelPosition(d,arc){var centroid;if(_externalLabelRadius){centroid=d3.svg.arc().outerRadius(_radius+_externalLabelRadius).innerRadius(_radius+_externalLabelRadius).centroid(d);}else{centroid=arc.centroid(d);}
if(isNaN(centroid[0])||isNaN(centroid[1])){return'translate(0,0)';}else{return'translate('+centroid+')';}}
_chart.legendables=function(){return _chart.data().map(function(d,i){var legendable={name:d.key,data:d.value,others:d.others,chart:_chart};legendable.color=_chart.getColor(d,i);return legendable;});};_chart.legendHighlight=function(d){highlightSliceFromLegendable(d,true);};_chart.legendReset=function(d){highlightSliceFromLegendable(d,false);};_chart.legendToggle=function(d){_chart.onClick({key:d.name,others:d.others});};function highlightSliceFromLegendable(legendable,highlighted){_chart.selectAll('g.pie-slice').each(function(d){if(legendable.name===d.data.key){d3.select(this).classed('highlight',highlighted);}});}
return _chart.anchor(parent,chartGroup);};dc.barChart=function(parent,chartGroup){var MIN_BAR_WIDTH=1;var DEFAULT_GAP_BETWEEN_BARS=2;var _chart=dc.stackMixin(dc.coordinateGridMixin({}));var _gap=DEFAULT_GAP_BETWEEN_BARS;var _centerBar=false;var _alwaysUseRounding=false;var _barWidth;dc.override(_chart,'rescale',function(){_chart._rescale();_barWidth=undefined;});dc.override(_chart,'render',function(){if(_chart.round()&&_centerBar&&!_alwaysUseRounding){dc.logger.warn('By default, brush rounding is disabled if bars are centered. '+'See dc.js bar chart API documentation for details.');}
_chart._render();});_chart.plotData=function(){var layers=_chart.chartBodyG().selectAll('g.stack').data(_chart.data());calculateBarWidth();layers.enter().append('g').attr('class',function(d,i){return'stack '+'_'+i;});layers.each(function(d,i){var layer=d3.select(this);renderBars(layer,i,d);});};function barHeight(d){return dc.utils.safeNumber(Math.abs(_chart.y()(d.y+d.y0)-_chart.y()(d.y0)));}
function renderBars(layer,layerIndex,d){var bars=layer.selectAll('rect.bar').data(d.values,dc.pluck('x'));var enter=bars.enter().append('rect').attr('class','bar').attr('fill',dc.pluck('data',_chart.getColor)).attr('y',_chart.yAxisHeight()).attr('height',0);if(_chart.renderTitle()){enter.append('title').text(dc.pluck('data',_chart.title(d.name)));}
if(_chart.isOrdinal()){bars.on('click',_chart.onClick);}
dc.transition(bars,_chart.transitionDuration()).attr('x',function(d){var x=_chart.x()(d.x);if(_centerBar){x-=_barWidth/2;}
if(_chart.isOrdinal()&&_gap!==undefined){x+=_gap/2;}
return dc.utils.safeNumber(x);}).attr('y',function(d){var y=_chart.y()(d.y+d.y0);if(d.y<0){y-=barHeight(d);}
return dc.utils.safeNumber(y);}).attr('width',_barWidth).attr('height',function(d){return barHeight(d);}).attr('fill',dc.pluck('data',_chart.getColor)).select('title').text(dc.pluck('data',_chart.title(d.name)));dc.transition(bars.exit(),_chart.transitionDuration()).attr('height',0).remove();}
function calculateBarWidth(){if(_barWidth===undefined){var numberOfBars=_chart.xUnitCount();if(_chart.isOrdinal()&&_gap===undefined){_barWidth=Math.floor(_chart.x().rangeBand());}else if(_gap){_barWidth=Math.floor((_chart.xAxisLength()-(numberOfBars-1)*_gap)/numberOfBars);}else{_barWidth=Math.floor(_chart.xAxisLength()/(1+_chart.barPadding())/numberOfBars);}
if(_barWidth===Infinity||isNaN(_barWidth)||_barWidth<MIN_BAR_WIDTH){_barWidth=MIN_BAR_WIDTH;}}}
_chart.fadeDeselectedArea=function(){var bars=_chart.chartBodyG().selectAll('rect.bar');var extent=_chart.brush().extent();if(_chart.isOrdinal()){if(_chart.hasFilter()){bars.classed(dc.constants.SELECTED_CLASS,function(d){return _chart.hasFilter(d.x);});bars.classed(dc.constants.DESELECTED_CLASS,function(d){return!_chart.hasFilter(d.x);});}else{bars.classed(dc.constants.SELECTED_CLASS,false);bars.classed(dc.constants.DESELECTED_CLASS,false);}}else{if(!_chart.brushIsEmpty(extent)){var start=extent[0];var end=extent[1];bars.classed(dc.constants.DESELECTED_CLASS,function(d){return d.x<start||d.x>=end;});}else{bars.classed(dc.constants.DESELECTED_CLASS,false);}}};_chart.centerBar=function(_){if(!arguments.length){return _centerBar;}
_centerBar=_;return _chart;};dc.override(_chart,'onClick',function(d){_chart._onClick(d.data);});_chart.barPadding=function(_){if(!arguments.length){return _chart._rangeBandPadding();}
_chart._rangeBandPadding(_);_gap=undefined;return _chart;};_chart._useOuterPadding=function(){return _gap===undefined;};_chart.outerPadding=_chart._outerRangeBandPadding;_chart.gap=function(_){if(!arguments.length){return _gap;}
_gap=_;return _chart;};_chart.extendBrush=function(){var extent=_chart.brush().extent();if(_chart.round()&&(!_centerBar||_alwaysUseRounding)){extent[0]=extent.map(_chart.round())[0];extent[1]=extent.map(_chart.round())[1];_chart.chartBodyG().select('.brush').call(_chart.brush().extent(extent));}
return extent;};_chart.alwaysUseRounding=function(_){if(!arguments.length){return _alwaysUseRounding;}
_alwaysUseRounding=_;return _chart;};function colorFilter(color,inv){return function(){var item=d3.select(this);var match=item.attr('fill')===color;return inv?!match:match;};}
_chart.legendHighlight=function(d){if(!_chart.isLegendableHidden(d)){_chart.g().selectAll('rect.bar').classed('highlight',colorFilter(d.color)).classed('fadeout',colorFilter(d.color,true));}};_chart.legendReset=function(){_chart.g().selectAll('rect.bar').classed('highlight',false).classed('fadeout',false);};dc.override(_chart,'xAxisMax',function(){var max=this._xAxisMax();if('resolution'in _chart.xUnits()){var res=_chart.xUnits().resolution;max+=res;}
return max;});return _chart.anchor(parent,chartGroup);};dc.lineChart=function(parent,chartGroup){var DEFAULT_DOT_RADIUS=5;var TOOLTIP_G_CLASS='dc-tooltip';var DOT_CIRCLE_CLASS='dot';var Y_AXIS_REF_LINE_CLASS='yRef';var X_AXIS_REF_LINE_CLASS='xRef';var DEFAULT_DOT_OPACITY=1e-6;var _chart=dc.stackMixin(dc.coordinateGridMixin({}));var _renderArea=false;var _dotRadius=DEFAULT_DOT_RADIUS;var _dataPointRadius=null;var _dataPointFillOpacity=DEFAULT_DOT_OPACITY;var _dataPointStrokeOpacity=DEFAULT_DOT_OPACITY;var _interpolate='linear';var _tension=0.7;var _defined;var _dashStyle;var _xyTipsOn=true;_chart.transitionDuration(500);_chart._rangeBandPadding(1);_chart.plotData=function(){var chartBody=_chart.chartBodyG();var layersList=chartBody.selectAll('g.stack-list');if(layersList.empty()){layersList=chartBody.append('g').attr('class','stack-list');}
var layers=layersList.selectAll('g.stack').data(_chart.data());var layersEnter=layers.enter().append('g').attr('class',function(d,i){return'stack '+'_'+i;});drawLine(layersEnter,layers);drawArea(layersEnter,layers);drawDots(chartBody,layers);};_chart.interpolate=function(_){if(!arguments.length){return _interpolate;}
_interpolate=_;return _chart;};_chart.tension=function(_){if(!arguments.length){return _tension;}
_tension=_;return _chart;};_chart.defined=function(_){if(!arguments.length){return _defined;}
_defined=_;return _chart;};_chart.dashStyle=function(_){if(!arguments.length){return _dashStyle;}
_dashStyle=_;return _chart;};_chart.renderArea=function(_){if(!arguments.length){return _renderArea;}
_renderArea=_;return _chart;};function colors(d,i){return _chart.getColor.call(d,d.values,i);}
function drawLine(layersEnter,layers){var line=d3.svg.line().x(function(d){return _chart.x()(d.x);}).y(function(d){return _chart.y()(d.y+d.y0);}).interpolate(_interpolate).tension(_tension);if(_defined){line.defined(_defined);}
var path=layersEnter.append('path').attr('class','line').attr('stroke',colors);if(_dashStyle){path.attr('stroke-dasharray',_dashStyle);}
dc.transition(layers.select('path.line'),_chart.transitionDuration()).attr('stroke',colors).attr('d',function(d){return safeD(line(d.values));});}
function drawArea(layersEnter,layers){if(_renderArea){var area=d3.svg.area().x(function(d){return _chart.x()(d.x);}).y(function(d){return _chart.y()(d.y+d.y0);}).y0(function(d){return _chart.y()(d.y0);}).interpolate(_interpolate).tension(_tension);if(_defined){area.defined(_defined);}
layersEnter.append('path').attr('class','area').attr('fill',colors).attr('d',function(d){return safeD(area(d.values));});dc.transition(layers.select('path.area'),_chart.transitionDuration()).attr('fill',colors).attr('d',function(d){return safeD(area(d.values));});}}
function safeD(d){return(!d||d.indexOf('NaN')>=0)?'M0,0':d;}
function drawDots(chartBody,layers){if(!_chart.brushOn()&&_chart.xyTipsOn()){var tooltipListClass=TOOLTIP_G_CLASS+'-list';var tooltips=chartBody.select('g.'+tooltipListClass);if(tooltips.empty()){tooltips=chartBody.append('g').attr('class',tooltipListClass);}
layers.each(function(d,layerIndex){var points=d.values;if(_defined){points=points.filter(_defined);}
var g=tooltips.select('g.'+TOOLTIP_G_CLASS+'._'+layerIndex);if(g.empty()){g=tooltips.append('g').attr('class',TOOLTIP_G_CLASS+' _'+layerIndex);}
createRefLines(g);var dots=g.selectAll('circle.'+DOT_CIRCLE_CLASS).data(points,dc.pluck('x'));dots.enter().append('circle').attr('class',DOT_CIRCLE_CLASS).attr('r',getDotRadius()).style('fill-opacity',_dataPointFillOpacity).style('stroke-opacity',_dataPointStrokeOpacity).on('mousemove',function(){var dot=d3.select(this);showDot(dot);showRefLines(dot,g);}).on('mouseout',function(){var dot=d3.select(this);hideDot(dot);hideRefLines(g);});dots.attr('cx',function(d){return dc.utils.safeNumber(_chart.x()(d.x));}).attr('cy',function(d){return dc.utils.safeNumber(_chart.y()(d.y+d.y0));}).attr('fill',_chart.getColor).call(renderTitle,d);dots.exit().remove();});}}
function createRefLines(g){var yRefLine=g.select('path.'+Y_AXIS_REF_LINE_CLASS).empty()?g.append('path').attr('class',Y_AXIS_REF_LINE_CLASS):g.select('path.'+Y_AXIS_REF_LINE_CLASS);yRefLine.style('display','none').attr('stroke-dasharray','5,5');var xRefLine=g.select('path.'+X_AXIS_REF_LINE_CLASS).empty()?g.append('path').attr('class',X_AXIS_REF_LINE_CLASS):g.select('path.'+X_AXIS_REF_LINE_CLASS);xRefLine.style('display','none').attr('stroke-dasharray','5,5');}
function showDot(dot){dot.style('fill-opacity',0.8);dot.style('stroke-opacity',0.8);dot.attr('r',_dotRadius);return dot;}
function showRefLines(dot,g){var x=dot.attr('cx');var y=dot.attr('cy');var yAxisX=(_chart._yAxisX()-_chart.margins().left);var yAxisRefPathD='M'+yAxisX+' '+y+'L'+(x)+' '+(y);var xAxisRefPathD='M'+x+' '+_chart.yAxisHeight()+'L'+x+' '+y;g.select('path.'+Y_AXIS_REF_LINE_CLASS).style('display','').attr('d',yAxisRefPathD);g.select('path.'+X_AXIS_REF_LINE_CLASS).style('display','').attr('d',xAxisRefPathD);}
function getDotRadius(){return _dataPointRadius||_dotRadius;}
function hideDot(dot){dot.style('fill-opacity',_dataPointFillOpacity).style('stroke-opacity',_dataPointStrokeOpacity).attr('r',getDotRadius());}
function hideRefLines(g){g.select('path.'+Y_AXIS_REF_LINE_CLASS).style('display','none');g.select('path.'+X_AXIS_REF_LINE_CLASS).style('display','none');}
function renderTitle(dot,d){if(_chart.renderTitle()){dot.selectAll('title').remove();dot.append('title').text(dc.pluck('data',_chart.title(d.name)));}}
_chart.xyTipsOn=function(_){if(!arguments.length){return _xyTipsOn;}
_xyTipsOn=_;return _chart;};_chart.dotRadius=function(_){if(!arguments.length){return _dotRadius;}
_dotRadius=_;return _chart;};_chart.renderDataPoints=function(options){if(!arguments.length){return{fillOpacity:_dataPointFillOpacity,strokeOpacity:_dataPointStrokeOpacity,radius:_dataPointRadius};}else if(!options){_dataPointFillOpacity=DEFAULT_DOT_OPACITY;_dataPointStrokeOpacity=DEFAULT_DOT_OPACITY;_dataPointRadius=null;}else{_dataPointFillOpacity=options.fillOpacity||0.8;_dataPointStrokeOpacity=options.strokeOpacity||0.8;_dataPointRadius=options.radius||2;}
return _chart;};function colorFilter(color,dashstyle,inv){return function(){var item=d3.select(this);var match=(item.attr('stroke')===color&&item.attr('stroke-dasharray')===((dashstyle instanceof Array)?dashstyle.join(','):null))||item.attr('fill')===color;return inv?!match:match;};}
_chart.legendHighlight=function(d){if(!_chart.isLegendableHidden(d)){_chart.g().selectAll('path.line, path.area').classed('highlight',colorFilter(d.color,d.dashstyle)).classed('fadeout',colorFilter(d.color,d.dashstyle,true));}};_chart.legendReset=function(){_chart.g().selectAll('path.line, path.area').classed('highlight',false).classed('fadeout',false);};dc.override(_chart,'legendables',function(){var legendables=_chart._legendables();if(!_dashStyle){return legendables;}
return legendables.map(function(l){l.dashstyle=_dashStyle;return l;});});return _chart.anchor(parent,chartGroup);};dc.dataCount=function(parent,chartGroup){var _formatNumber=d3.format(',d');var _chart=dc.baseMixin({});var _html={some:'',all:''};_chart.html=function(s){if(!arguments.length){return _html;}
if(s.all){_html.all=s.all;}
if(s.some){_html.some=s.some;}
return _chart;};_chart.formatNumber=function(s){if(!arguments.length){return _formatNumber;}
_formatNumber=s;return _chart;};_chart._doRender=function(){var tot=_chart.dimension().size(),val=_chart.group().value();var all=_formatNumber(tot);var selected=_formatNumber(val);if((tot===val)&&(_html.all!=='')){_chart.root().html(_html.all.replace('%total-count',all).replace('%filter-count',selected));}else if(_html.some!==''){_chart.root().html(_html.some.replace('%total-count',all).replace('%filter-count',selected));}else{_chart.selectAll('.total-count').text(all);_chart.selectAll('.filter-count').text(selected);}
return _chart;};_chart._doRedraw=function(){return _chart._doRender();};return _chart.anchor(parent,chartGroup);};dc.dataTable=function(parent,chartGroup){var LABEL_CSS_CLASS='dc-table-label';var ROW_CSS_CLASS='dc-table-row';var COLUMN_CSS_CLASS='dc-table-column';var GROUP_CSS_CLASS='dc-table-group';var HEAD_CSS_CLASS='dc-table-head';var _chart=dc.baseMixin({});var _size=25;var _columns=[];var _sortBy=function(d){return d;};var _order=d3.ascending;_chart._doRender=function(){_chart.selectAll('tbody').remove();renderRows(renderGroups());return _chart;};_chart._doColumnValueFormat=function(v,d){return((typeof v==='function')?v(d):((typeof v==='string')?d[v]:v.format(d)));};_chart._doColumnHeaderFormat=function(d){return(typeof d==='function')?_chart._doColumnHeaderFnToString(d):((typeof d==='string')?_chart._doColumnHeaderCapitalize(d):String(d.label));};_chart._doColumnHeaderCapitalize=function(s){return s.charAt(0).toUpperCase()+s.slice(1);};_chart._doColumnHeaderFnToString=function(f){var s=String(f);var i1=s.indexOf('return ');if(i1>=0){var i2=s.lastIndexOf(';');if(i2>=0){s=s.substring(i1+7,i2);var i3=s.indexOf('numberFormat');if(i3>=0){s=s.replace('numberFormat','');}}}
return s;};function renderGroups(){var bAllFunctions=true;_columns.forEach(function(f){bAllFunctions=bAllFunctions&(typeof f==='function');});if(!bAllFunctions){_chart.selectAll('th').remove();var headcols=_chart.root().selectAll('th').data(_columns);var headGroup=headcols.enter().append('th');headGroup.attr('class',HEAD_CSS_CLASS).html(function(d){return(_chart._doColumnHeaderFormat(d));});}
var groups=_chart.root().selectAll('tbody').data(nestEntries(),function(d){return _chart.keyAccessor()(d);});var rowGroup=groups.enter().append('tbody');rowGroup.append('tr').attr('class',GROUP_CSS_CLASS).append('td').attr('class',LABEL_CSS_CLASS).attr('colspan',_columns.length).html(function(d){return _chart.keyAccessor()(d);});groups.exit().remove();return rowGroup;}
function nestEntries(){var entries;if(_order===d3.ascending){entries=_chart.dimension().bottom(_size);}else{entries=_chart.dimension().top(_size);}
return d3.nest().key(_chart.group()).sortKeys(_order).entries(entries.sort(function(a,b){return _order(_sortBy(a),_sortBy(b));}));}
function renderRows(groups){var rows=groups.order().selectAll('tr.'+ROW_CSS_CLASS).data(function(d){return d.values;});var rowEnter=rows.enter().append('tr').attr('class',ROW_CSS_CLASS);_columns.forEach(function(v,i){rowEnter.append('td').attr('class',COLUMN_CSS_CLASS+' _'+i).html(function(d){return _chart._doColumnValueFormat(v,d);});});rows.exit().remove();return rows;}
_chart._doRedraw=function(){return _chart._doRender();};_chart.size=function(s){if(!arguments.length){return _size;}
_size=s;return _chart;};_chart.columns=function(_){if(!arguments.length){return _columns;}
_columns=_;return _chart;};_chart.sortBy=function(_){if(!arguments.length){return _sortBy;}
_sortBy=_;return _chart;};_chart.order=function(_){if(!arguments.length){return _order;}
_order=_;return _chart;};return _chart.anchor(parent,chartGroup);};dc.dataGrid=function(parent,chartGroup){var LABEL_CSS_CLASS='dc-grid-label';var ITEM_CSS_CLASS='dc-grid-item';var GROUP_CSS_CLASS='dc-grid-group';var GRID_CSS_CLASS='dc-grid-top';var _chart=dc.baseMixin({});var _size=999;var _html=function(d){return'you need to provide an html() handling param:  '+JSON.stringify(d);};var _sortBy=function(d){return d;};var _order=d3.ascending;var _htmlGroup=function(d){return'<div class=\''+GROUP_CSS_CLASS+'\'><h1 class=\''+LABEL_CSS_CLASS+'\'>'+_chart.keyAccessor()(d)+'</h1></div>';};_chart._doRender=function(){_chart.selectAll('div.'+GRID_CSS_CLASS).remove();renderItems(renderGroups());return _chart;};function renderGroups(){var groups=_chart.root().selectAll('div.'+GRID_CSS_CLASS).data(nestEntries(),function(d){return _chart.keyAccessor()(d);});var itemGroup=groups.enter().append('div').attr('class',GRID_CSS_CLASS);if(_htmlGroup){itemGroup.html(function(d){return _htmlGroup(d);});}
groups.exit().remove();return itemGroup;}
function nestEntries(){var entries=_chart.dimension().top(_size);return d3.nest().key(_chart.group()).sortKeys(_order).entries(entries.sort(function(a,b){return _order(_sortBy(a),_sortBy(b));}));}
function renderItems(groups){var items=groups.order().selectAll('div.'+ITEM_CSS_CLASS).data(function(d){return d.values;});items.enter().append('div').attr('class',ITEM_CSS_CLASS).html(function(d){return _html(d);});items.exit().remove();return items;}
_chart._doRedraw=function(){return _chart._doRender();};_chart.size=function(s){if(!arguments.length){return _size;}
_size=s;return _chart;};_chart.html=function(_){if(!arguments.length){return _html;}
_html=_;return _chart;};_chart.htmlGroup=function(_){if(!arguments.length){return _htmlGroup;}
_htmlGroup=_;return _chart;};_chart.sortBy=function(_){if(!arguments.length){return _sortBy;}
_sortBy=_;return _chart;};_chart.order=function(_){if(!arguments.length){return _order;}
_order=_;return _chart;};return _chart.anchor(parent,chartGroup);};dc.bubbleChart=function(parent,chartGroup){var _chart=dc.bubbleMixin(dc.coordinateGridMixin({}));var _elasticRadius=false;_chart.transitionDuration(750);var bubbleLocator=function(d){return'translate('+(bubbleX(d))+','+(bubbleY(d))+')';};_chart.elasticRadius=function(_){if(!arguments.length){return _elasticRadius;}
_elasticRadius=_;return _chart;};_chart.plotData=function(){if(_elasticRadius){_chart.r().domain([_chart.rMin(),_chart.rMax()]);}
_chart.r().range([_chart.MIN_RADIUS,_chart.xAxisLength()*_chart.maxBubbleRelativeSize()]);var bubbleG=_chart.chartBodyG().selectAll('g.'+_chart.BUBBLE_NODE_CLASS).data(_chart.data(),function(d){return d.key;});renderNodes(bubbleG);updateNodes(bubbleG);removeNodes(bubbleG);_chart.fadeDeselectedArea();};function renderNodes(bubbleG){var bubbleGEnter=bubbleG.enter().append('g');bubbleGEnter.attr('class',_chart.BUBBLE_NODE_CLASS).attr('transform',bubbleLocator).append('circle').attr('class',function(d,i){return _chart.BUBBLE_CLASS+' _'+i;}).on('click',_chart.onClick).attr('fill',_chart.getColor).attr('r',0);dc.transition(bubbleG,_chart.transitionDuration()).selectAll('circle.'+_chart.BUBBLE_CLASS).attr('r',function(d){return _chart.bubbleR(d);}).attr('opacity',function(d){return(_chart.bubbleR(d)>0)?1:0;});_chart._doRenderLabel(bubbleGEnter);_chart._doRenderTitles(bubbleGEnter);}
function updateNodes(bubbleG){dc.transition(bubbleG,_chart.transitionDuration()).attr('transform',bubbleLocator).selectAll('circle.'+_chart.BUBBLE_CLASS).attr('fill',_chart.getColor).attr('r',function(d){return _chart.bubbleR(d);}).attr('opacity',function(d){return(_chart.bubbleR(d)>0)?1:0;});_chart.doUpdateLabels(bubbleG);_chart.doUpdateTitles(bubbleG);}
function removeNodes(bubbleG){bubbleG.exit().remove();}
function bubbleX(d){var x=_chart.x()(_chart.keyAccessor()(d));if(isNaN(x)){x=0;}
return x;}
function bubbleY(d){var y=_chart.y()(_chart.valueAccessor()(d));if(isNaN(y)){y=0;}
return y;}
_chart.renderBrush=function(){};_chart.redrawBrush=function(){_chart.fadeDeselectedArea();};return _chart.anchor(parent,chartGroup);};dc.compositeChart=function(parent,chartGroup){var SUB_CHART_CLASS='sub';var DEFAULT_RIGHT_Y_AXIS_LABEL_PADDING=12;var _chart=dc.coordinateGridMixin({});var _children=[];var _childOptions={};var _shareColors=false,_shareTitle=true;var _rightYAxis=d3.svg.axis(),_rightYAxisLabel=0,_rightYAxisLabelPadding=DEFAULT_RIGHT_Y_AXIS_LABEL_PADDING,_rightY,_rightAxisGridLines=false;_chart._mandatoryAttributes([]);_chart.transitionDuration(500);dc.override(_chart,'_generateG',function(){var g=this.__generateG();for(var i=0;i<_children.length;++i){var child=_children[i];generateChildG(child,i);if(!child.dimension()){child.dimension(_chart.dimension());}
if(!child.group()){child.group(_chart.group());}
child.chartGroup(_chart.chartGroup());child.svg(_chart.svg());child.xUnits(_chart.xUnits());child.transitionDuration(_chart.transitionDuration());child.brushOn(_chart.brushOn());child.renderTitle(_chart.renderTitle());child.elasticX(_chart.elasticX());}
return g;});_chart._brushing=function(){var extent=_chart.extendBrush();var brushIsEmpty=_chart.brushIsEmpty(extent);for(var i=0;i<_children.length;++i){_children[i].filter(null);if(!brushIsEmpty){_children[i].filter(extent);}}};_chart._prepareYAxis=function(){if(leftYAxisChildren().length!==0){prepareLeftYAxis();}
if(rightYAxisChildren().length!==0){prepareRightYAxis();}
if(leftYAxisChildren().length>0&&!_rightAxisGridLines){_chart._renderHorizontalGridLinesForAxis(_chart.g(),_chart.y(),_chart.yAxis());}
else if(rightYAxisChildren().length>0){_chart._renderHorizontalGridLinesForAxis(_chart.g(),_rightY,_rightYAxis);}};_chart.renderYAxis=function(){if(leftYAxisChildren().length!==0){_chart.renderYAxisAt('y',_chart.yAxis(),_chart.margins().left);_chart.renderYAxisLabel('y',_chart.yAxisLabel(),-90);}
if(rightYAxisChildren().length!==0){_chart.renderYAxisAt('yr',_chart.rightYAxis(),_chart.width()-_chart.margins().right);_chart.renderYAxisLabel('yr',_chart.rightYAxisLabel(),90,_chart.width()-_rightYAxisLabelPadding);}};function prepareRightYAxis(){if(_chart.rightY()===undefined||_chart.elasticY()){_chart.rightY(d3.scale.linear());_chart.rightY().domain([rightYAxisMin(),rightYAxisMax()]).rangeRound([_chart.yAxisHeight(),0]);}
_chart.rightY().range([_chart.yAxisHeight(),0]);_chart.rightYAxis(_chart.rightYAxis().scale(_chart.rightY()));_chart.rightYAxis().orient('right');}
function prepareLeftYAxis(){if(_chart.y()===undefined||_chart.elasticY()){_chart.y(d3.scale.linear());_chart.y().domain([yAxisMin(),yAxisMax()]).rangeRound([_chart.yAxisHeight(),0]);}
_chart.y().range([_chart.yAxisHeight(),0]);_chart.yAxis(_chart.yAxis().scale(_chart.y()));_chart.yAxis().orient('left');}
function generateChildG(child,i){child._generateG(_chart.g());child.g().attr('class',SUB_CHART_CLASS+' _'+i);}
_chart.plotData=function(){for(var i=0;i<_children.length;++i){var child=_children[i];if(!child.g()){generateChildG(child,i);}
if(_shareColors){child.colors(_chart.colors());}
child.x(_chart.x());child.xAxis(_chart.xAxis());if(child.useRightYAxis()){child.y(_chart.rightY());child.yAxis(_chart.rightYAxis());}
else{child.y(_chart.y());child.yAxis(_chart.yAxis());}
child.plotData();child._activateRenderlets();}};_chart.useRightAxisGridLines=function(_){if(!arguments){return _rightAxisGridLines;}
_rightAxisGridLines=_;return _chart;};_chart.childOptions=function(_){if(!arguments.length){return _childOptions;}
_childOptions=_;_children.forEach(function(child){child.options(_childOptions);});return _chart;};_chart.fadeDeselectedArea=function(){for(var i=0;i<_children.length;++i){var child=_children[i];child.brush(_chart.brush());child.fadeDeselectedArea();}};_chart.rightYAxisLabel=function(_,padding){if(!arguments.length){return _rightYAxisLabel;}
_rightYAxisLabel=_;_chart.margins().right-=_rightYAxisLabelPadding;_rightYAxisLabelPadding=(padding===undefined)?DEFAULT_RIGHT_Y_AXIS_LABEL_PADDING:padding;_chart.margins().right+=_rightYAxisLabelPadding;return _chart;};_chart.compose=function(charts){_children=charts;_children.forEach(function(child){child.height(_chart.height());child.width(_chart.width());child.margins(_chart.margins());if(_shareTitle){child.title(_chart.title());}
child.options(_childOptions);});return _chart;};_chart.children=function(){return _children;};_chart.shareColors=function(_){if(!arguments.length){return _shareColors;}
_shareColors=_;return _chart;};_chart.shareTitle=function(_){if(!arguments.length){return _shareTitle;}
_shareTitle=_;return _chart;};_chart.rightY=function(_){if(!arguments.length){return _rightY;}
_rightY=_;return _chart;};function leftYAxisChildren(){return _children.filter(function(child){return!child.useRightYAxis();});}
function rightYAxisChildren(){return _children.filter(function(child){return child.useRightYAxis();});}
function getYAxisMin(charts){return charts.map(function(c){return c.yAxisMin();});}
delete _chart.yAxisMin;function yAxisMin(){return d3.min(getYAxisMin(leftYAxisChildren()));}
function rightYAxisMin(){return d3.min(getYAxisMin(rightYAxisChildren()));}
function getYAxisMax(charts){return charts.map(function(c){return c.yAxisMax();});}
delete _chart.yAxisMax;function yAxisMax(){return dc.utils.add(d3.max(getYAxisMax(leftYAxisChildren())),_chart.yAxisPadding());}
function rightYAxisMax(){return dc.utils.add(d3.max(getYAxisMax(rightYAxisChildren())),_chart.yAxisPadding());}
function getAllXAxisMinFromChildCharts(){return _children.map(function(c){return c.xAxisMin();});}
dc.override(_chart,'xAxisMin',function(){return dc.utils.subtract(d3.min(getAllXAxisMinFromChildCharts()),_chart.xAxisPadding());});function getAllXAxisMaxFromChildCharts(){return _children.map(function(c){return c.xAxisMax();});}
dc.override(_chart,'xAxisMax',function(){return dc.utils.add(d3.max(getAllXAxisMaxFromChildCharts()),_chart.xAxisPadding());});_chart.legendables=function(){return _children.reduce(function(items,child){if(_shareColors){child.colors(_chart.colors());}
items.push.apply(items,child.legendables());return items;},[]);};_chart.legendHighlight=function(d){for(var j=0;j<_children.length;++j){var child=_children[j];child.legendHighlight(d);}};_chart.legendReset=function(d){for(var j=0;j<_children.length;++j){var child=_children[j];child.legendReset(d);}};_chart.legendToggle=function(){console.log('composite should not be getting legendToggle itself');};_chart.rightYAxis=function(rightYAxis){if(!arguments.length){return _rightYAxis;}
_rightYAxis=rightYAxis;return _chart;};return _chart.anchor(parent,chartGroup);};dc.seriesChart=function(parent,chartGroup){var _chart=dc.compositeChart(parent,chartGroup);function keySort(a,b){return d3.ascending(_chart.keyAccessor()(a),_chart.keyAccessor()(b));}
var _charts={};var _chartFunction=dc.lineChart;var _seriesAccessor;var _seriesSort=d3.ascending;var _valueSort=keySort;_chart._mandatoryAttributes().push('seriesAccessor','chart');_chart.shareColors(true);_chart._preprocessData=function(){var keep=[];var childrenChanged;var nester=d3.nest().key(_seriesAccessor);if(_seriesSort){nester.sortKeys(_seriesSort);}
if(_valueSort){nester.sortValues(_valueSort);}
var nesting=nester.entries(_chart.data());var children=nesting.map(function(sub,i){var subChart=_charts[sub.key]||_chartFunction.call(_chart,_chart,chartGroup,sub.key,i);if(!_charts[sub.key]){childrenChanged=true;}
_charts[sub.key]=subChart;keep.push(sub.key);return subChart.dimension(_chart.dimension()).group({all:d3.functor(sub.values)},sub.key).keyAccessor(_chart.keyAccessor()).valueAccessor(_chart.valueAccessor()).brushOn(_chart.brushOn());});Object.keys(_charts).filter(function(c){return keep.indexOf(c)===-1;}).forEach(function(c){clearChart(c);childrenChanged=true;});_chart._compose(children);if(childrenChanged&&_chart.legend()){_chart.legend().render();}};function clearChart(c){if(_charts[c].g()){_charts[c].g().remove();}
delete _charts[c];}
function resetChildren(){Object.keys(_charts).map(clearChart);_charts={};}
_chart.chart=function(_){if(!arguments.length){return _chartFunction;}
_chartFunction=_;resetChildren();return _chart;};_chart.seriesAccessor=function(_){if(!arguments.length){return _seriesAccessor;}
_seriesAccessor=_;resetChildren();return _chart;};_chart.seriesSort=function(_){if(!arguments.length){return _seriesSort;}
_seriesSort=_;resetChildren();return _chart;};_chart.valueSort=function(_){if(!arguments.length){return _valueSort;}
_valueSort=_;resetChildren();return _chart;};_chart._compose=_chart.compose;delete _chart.compose;return _chart;};dc.geoChoroplethChart=function(parent,chartGroup){var _chart=dc.colorMixin(dc.baseMixin({}));_chart.colorAccessor(function(d){return d||0;});var _geoPath=d3.geo.path();var _projectionFlag;var _geoJsons=[];_chart._doRender=function(){_chart.resetSvg();for(var layerIndex=0;layerIndex<_geoJsons.length;++layerIndex){var states=_chart.svg().append('g').attr('class','layer'+layerIndex);var regionG=states.selectAll('g.'+geoJson(layerIndex).name).data(geoJson(layerIndex).data).enter().append('g').attr('class',geoJson(layerIndex).name);regionG.append('path').attr('fill','white').attr('d',_geoPath);regionG.append('title');plotData(layerIndex);}
_projectionFlag=false;};function plotData(layerIndex){var data=generateLayeredData();if(isDataLayer(layerIndex)){var regionG=renderRegionG(layerIndex);renderPaths(regionG,layerIndex,data);renderTitle(regionG,layerIndex,data);}}
function generateLayeredData(){var data={};var groupAll=_chart.data();for(var i=0;i<groupAll.length;++i){data[_chart.keyAccessor()(groupAll[i])]=_chart.valueAccessor()(groupAll[i]);}
return data;}
function isDataLayer(layerIndex){return geoJson(layerIndex).keyAccessor;}
function renderRegionG(layerIndex){var regionG=_chart.svg().selectAll(layerSelector(layerIndex)).classed('selected',function(d){return isSelected(layerIndex,d);}).classed('deselected',function(d){return isDeselected(layerIndex,d);}).attr('class',function(d){var layerNameClass=geoJson(layerIndex).name;var regionClass=dc.utils.nameToId(geoJson(layerIndex).keyAccessor(d));var baseClasses=layerNameClass+' '+regionClass;if(isSelected(layerIndex,d)){baseClasses+=' selected';}
if(isDeselected(layerIndex,d)){baseClasses+=' deselected';}
return baseClasses;});return regionG;}
function layerSelector(layerIndex){return'g.layer'+layerIndex+' g.'+geoJson(layerIndex).name;}
function isSelected(layerIndex,d){return _chart.hasFilter()&&_chart.hasFilter(getKey(layerIndex,d));}
function isDeselected(layerIndex,d){return _chart.hasFilter()&&!_chart.hasFilter(getKey(layerIndex,d));}
function getKey(layerIndex,d){return geoJson(layerIndex).keyAccessor(d);}
function geoJson(index){return _geoJsons[index];}
function renderPaths(regionG,layerIndex,data){var paths=regionG.select('path').attr('fill',function(){var currentFill=d3.select(this).attr('fill');if(currentFill){return currentFill;}
return'none';}).on('click',function(d){return _chart.onClick(d,layerIndex);});dc.transition(paths,_chart.transitionDuration()).attr('fill',function(d,i){return _chart.getColor(data[geoJson(layerIndex).keyAccessor(d)],i);});}
_chart.onClick=function(d,layerIndex){var selectedRegion=geoJson(layerIndex).keyAccessor(d);dc.events.trigger(function(){_chart.filter(selectedRegion);_chart.redrawGroup();});};function renderTitle(regionG,layerIndex,data){if(_chart.renderTitle()){regionG.selectAll('title').text(function(d){var key=getKey(layerIndex,d);var value=data[key];return _chart.title()({key:key,value:value});});}}
_chart._doRedraw=function(){for(var layerIndex=0;layerIndex<_geoJsons.length;++layerIndex){plotData(layerIndex);if(_projectionFlag){_chart.svg().selectAll('g.'+geoJson(layerIndex).name+' path').attr('d',_geoPath);}}
_projectionFlag=false;};_chart.overlayGeoJson=function(json,name,keyAccessor){for(var i=0;i<_geoJsons.length;++i){if(_geoJsons[i].name===name){_geoJsons[i].data=json;_geoJsons[i].keyAccessor=keyAccessor;return _chart;}}
_geoJsons.push({name:name,data:json,keyAccessor:keyAccessor});return _chart;};_chart.projection=function(projection){_geoPath.projection(projection);_projectionFlag=true;return _chart;};_chart.geoJsons=function(){return _geoJsons;};_chart.geoPath=function(){return _geoPath;};_chart.removeGeoJson=function(name){var geoJsons=[];for(var i=0;i<_geoJsons.length;++i){var layer=_geoJsons[i];if(layer.name!==name){geoJsons.push(layer);}}
_geoJsons=geoJsons;return _chart;};return _chart.anchor(parent,chartGroup);};dc.bubbleOverlay=function(root,chartGroup){var BUBBLE_OVERLAY_CLASS='bubble-overlay';var BUBBLE_NODE_CLASS='node';var BUBBLE_CLASS='bubble';var _chart=dc.bubbleMixin(dc.baseMixin({}));var _g;var _points=[];_chart.transitionDuration(750);_chart.radiusValueAccessor(function(d){return d.value;});_chart.point=function(name,x,y){_points.push({name:name,x:x,y:y});return _chart;};_chart._doRender=function(){_g=initOverlayG();_chart.r().range([_chart.MIN_RADIUS,_chart.width()*_chart.maxBubbleRelativeSize()]);initializeBubbles();_chart.fadeDeselectedArea();return _chart;};function initOverlayG(){_g=_chart.select('g.'+BUBBLE_OVERLAY_CLASS);if(_g.empty()){_g=_chart.svg().append('g').attr('class',BUBBLE_OVERLAY_CLASS);}
return _g;}
function initializeBubbles(){var data=mapData();_points.forEach(function(point){var nodeG=getNodeG(point,data);var circle=nodeG.select('circle.'+BUBBLE_CLASS);if(circle.empty()){circle=nodeG.append('circle').attr('class',BUBBLE_CLASS).attr('r',0).attr('fill',_chart.getColor).on('click',_chart.onClick);}
dc.transition(circle,_chart.transitionDuration()).attr('r',function(d){return _chart.bubbleR(d);});_chart._doRenderLabel(nodeG);_chart._doRenderTitles(nodeG);});}
function mapData(){var data={};_chart.data().forEach(function(datum){data[_chart.keyAccessor()(datum)]=datum;});return data;}
function getNodeG(point,data){var bubbleNodeClass=BUBBLE_NODE_CLASS+' '+dc.utils.nameToId(point.name);var nodeG=_g.select('g.'+dc.utils.nameToId(point.name));if(nodeG.empty()){nodeG=_g.append('g').attr('class',bubbleNodeClass).attr('transform','translate('+point.x+','+point.y+')');}
nodeG.datum(data[point.name]);return nodeG;}
_chart._doRedraw=function(){updateBubbles();_chart.fadeDeselectedArea();return _chart;};function updateBubbles(){var data=mapData();_points.forEach(function(point){var nodeG=getNodeG(point,data);var circle=nodeG.select('circle.'+BUBBLE_CLASS);dc.transition(circle,_chart.transitionDuration()).attr('r',function(d){return _chart.bubbleR(d);}).attr('fill',_chart.getColor);_chart.doUpdateLabels(nodeG);_chart.doUpdateTitles(nodeG);});}
_chart.debug=function(flag){if(flag){var debugG=_chart.select('g.'+dc.constants.DEBUG_GROUP_CLASS);if(debugG.empty()){debugG=_chart.svg().append('g').attr('class',dc.constants.DEBUG_GROUP_CLASS);}
var debugText=debugG.append('text').attr('x',10).attr('y',20);debugG.append('rect').attr('width',_chart.width()).attr('height',_chart.height()).on('mousemove',function(){var position=d3.mouse(debugG.node());var msg=position[0]+', '+position[1];debugText.text(msg);});}else{_chart.selectAll('.debug').remove();}
return _chart;};_chart.anchor(root,chartGroup);return _chart;};dc.rowChart=function(parent,chartGroup){var _g;var _labelOffsetX=10;var _labelOffsetY=15;var _hasLabelOffsetY=false;var _dyOffset='0.35em';var _titleLabelOffsetX=2;var _gap=5;var _fixedBarHeight=false;var _rowCssClass='row';var _titleRowCssClass='titlerow';var _renderTitleLabel=false;var _chart=dc.capMixin(dc.marginMixin(dc.colorMixin(dc.baseMixin({}))));var _x;var _elasticX;var _xAxis=d3.svg.axis().orient('bottom');var _rowData;_chart.rowsCap=_chart.cap;function calculateAxisScale(){if(!_x||_elasticX){var extent=d3.extent(_rowData,_chart.cappedValueAccessor);if(extent[0]>0){extent[0]=0;}
_x=d3.scale.linear().domain(extent).range([0,_chart.effectiveWidth()]);}
_xAxis.scale(_x);}
function drawAxis(){var axisG=_g.select('g.axis');calculateAxisScale();if(axisG.empty()){axisG=_g.append('g').attr('class','axis').attr('transform','translate(0, '+_chart.effectiveHeight()+')');}
dc.transition(axisG,_chart.transitionDuration()).call(_xAxis);}
_chart._doRender=function(){_chart.resetSvg();_g=_chart.svg().append('g').attr('transform','translate('+_chart.margins().left+','+_chart.margins().top+')');drawChart();return _chart;};_chart.title(function(d){return _chart.cappedKeyAccessor(d)+': '+_chart.cappedValueAccessor(d);});_chart.label(_chart.cappedKeyAccessor);_chart.x=function(x){if(!arguments.length){return _x;}
_x=x;return _chart;};function drawGridLines(){_g.selectAll('g.tick').select('line.grid-line').remove();_g.selectAll('g.tick').append('line').attr('class','grid-line').attr('x1',0).attr('y1',0).attr('x2',0).attr('y2',function(){return-_chart.effectiveHeight();});}
function drawChart(){_rowData=_chart.data();drawAxis();drawGridLines();var rows=_g.selectAll('g.'+_rowCssClass).data(_rowData);createElements(rows);removeElements(rows);updateElements(rows);}
function createElements(rows){var rowEnter=rows.enter().append('g').attr('class',function(d,i){return _rowCssClass+' _'+i;});rowEnter.append('rect').attr('width',0);createLabels(rowEnter);updateLabels(rows);}
function removeElements(rows){rows.exit().remove();}
function rootValue(){var root=_x(0);return(root===-Infinity||root!==root)?_x(1):root;}
function updateElements(rows){var n=_rowData.length;var height;if(!_fixedBarHeight){height=(_chart.effectiveHeight()-(n+1)*_gap)/n;}else{height=_fixedBarHeight;}
if(!_hasLabelOffsetY){_labelOffsetY=height/2;}
var rect=rows.attr('transform',function(d,i){return'translate(0,'+((i+1)*_gap+i*height)+')';}).select('rect').attr('height',height).attr('fill',_chart.getColor).on('click',onClick).classed('deselected',function(d){return(_chart.hasFilter())?!isSelectedRow(d):false;}).classed('selected',function(d){return(_chart.hasFilter())?isSelectedRow(d):false;});dc.transition(rect,_chart.transitionDuration()).attr('width',function(d){return Math.abs(rootValue()-_x(_chart.valueAccessor()(d)));}).attr('transform',translateX);createTitles(rows);updateLabels(rows);}
function createTitles(rows){if(_chart.renderTitle()){rows.selectAll('title').remove();rows.append('title').text(_chart.title());}}
function createLabels(rowEnter){if(_chart.renderLabel()){rowEnter.append('text').on('click',onClick);}
if(_chart.renderTitleLabel()){rowEnter.append('text').attr('class',_titleRowCssClass).on('click',onClick);}}
function updateLabels(rows){if(_chart.renderLabel()){var lab=rows.select('text').attr('x',_labelOffsetX).attr('y',_labelOffsetY).attr('dy',_dyOffset).on('click',onClick).attr('class',function(d,i){return _rowCssClass+' _'+i;}).text(function(d){return _chart.label()(d);});dc.transition(lab,_chart.transitionDuration()).attr('transform',translateX);}
if(_chart.renderTitleLabel()){var titlelab=rows.select('.'+_titleRowCssClass).attr('x',_chart.effectiveWidth()-_titleLabelOffsetX).attr('y',_labelOffsetY).attr('text-anchor','end').on('click',onClick).attr('class',function(d,i){return _titleRowCssClass+' _'+i;}).text(function(d){return _chart.title()(d);});dc.transition(titlelab,_chart.transitionDuration()).attr('transform',translateX);}}
_chart.renderTitleLabel=function(_){if(!arguments.length){return _renderTitleLabel;}
_renderTitleLabel=_;return _chart;};function onClick(d){_chart.onClick(d);}
function translateX(d){var x=_x(_chart.cappedValueAccessor(d)),x0=rootValue(),s=x>x0?x0:x;return'translate('+s+',0)';}
_chart._doRedraw=function(){drawChart();return _chart;};_chart.xAxis=function(){return _xAxis;};_chart.fixedBarHeight=function(g){if(!arguments.length){return _fixedBarHeight;}
_fixedBarHeight=g;return _chart;};_chart.gap=function(g){if(!arguments.length){return _gap;}
_gap=g;return _chart;};_chart.elasticX=function(_){if(!arguments.length){return _elasticX;}
_elasticX=_;return _chart;};_chart.labelOffsetX=function(o){if(!arguments.length){return _labelOffsetX;}
_labelOffsetX=o;return _chart;};_chart.labelOffsetY=function(o){if(!arguments.length){return _labelOffsetY;}
_labelOffsetY=o;_hasLabelOffsetY=true;return _chart;};_chart.titleLabelOffsetX=function(o){if(!arguments.length){return _titleLabelOffsetX;}
_titleLabelOffsetX=o;return _chart;};function isSelectedRow(d){return _chart.hasFilter(_chart.cappedKeyAccessor(d));}
return _chart.anchor(parent,chartGroup);};dc.legend=function(){var LABEL_GAP=2;var _legend={},_parent,_x=0,_y=0,_itemHeight=12,_gap=5,_horizontal=false,_legendWidth=560,_itemWidth=70,_autoItemWidth=false;var _g;_legend.parent=function(p){if(!arguments.length){return _parent;}
_parent=p;return _legend;};_legend.render=function(){_parent.svg().select('g.dc-legend').remove();_g=_parent.svg().append('g').attr('class','dc-legend').attr('transform','translate('+_x+','+_y+')');var legendables=_parent.legendables();var itemEnter=_g.selectAll('g.dc-legend-item').data(legendables).enter().append('g').attr('class','dc-legend-item').on('mouseover',function(d){_parent.legendHighlight(d);}).on('mouseout',function(d){_parent.legendReset(d);}).on('click',function(d){d.chart.legendToggle(d);});_g.selectAll('g.dc-legend-item').classed('fadeout',function(d){return d.chart.isLegendableHidden(d);});if(legendables.some(dc.pluck('dashstyle'))){itemEnter.append('line').attr('x1',0).attr('y1',_itemHeight/2).attr('x2',_itemHeight).attr('y2',_itemHeight/2).attr('stroke-width',2).attr('stroke-dasharray',dc.pluck('dashstyle')).attr('stroke',dc.pluck('color'));}else{itemEnter.append('rect').attr('width',_itemHeight).attr('height',_itemHeight).attr('fill',function(d){return d?d.color:'blue';});}
itemEnter.append('text').text(dc.pluck('name')).attr('x',_itemHeight+LABEL_GAP).attr('y',function(){return _itemHeight/2+(this.clientHeight?this.clientHeight:13)/2-2;});var _cumulativeLegendTextWidth=0;var row=0;itemEnter.attr('transform',function(d,i){if(_horizontal){var translateBy='translate('+_cumulativeLegendTextWidth+','+row*legendItemHeight()+')';var itemWidth=_autoItemWidth===true?this.getBBox().width+_gap:_itemWidth;if((_cumulativeLegendTextWidth+itemWidth)>=_legendWidth){++row;_cumulativeLegendTextWidth=0;}else{_cumulativeLegendTextWidth+=itemWidth;}
return translateBy;}
else{return'translate(0,'+i*legendItemHeight()+')';}});};function legendItemHeight(){return _gap+_itemHeight;}
_legend.x=function(x){if(!arguments.length){return _x;}
_x=x;return _legend;};_legend.y=function(y){if(!arguments.length){return _y;}
_y=y;return _legend;};_legend.gap=function(gap){if(!arguments.length){return _gap;}
_gap=gap;return _legend;};_legend.itemHeight=function(h){if(!arguments.length){return _itemHeight;}
_itemHeight=h;return _legend;};_legend.horizontal=function(_){if(!arguments.length){return _horizontal;}
_horizontal=_;return _legend;};_legend.legendWidth=function(_){if(!arguments.length){return _legendWidth;}
_legendWidth=_;return _legend;};_legend.itemWidth=function(_){if(!arguments.length){return _itemWidth;}
_itemWidth=_;return _legend;};_legend.autoItemWidth=function(_){if(!arguments.length){return _autoItemWidth;}
_autoItemWidth=_;return _legend;};return _legend;};dc.scatterPlot=function(parent,chartGroup){var _chart=dc.coordinateGridMixin({});var _symbol=d3.svg.symbol();var _existenceAccessor=function(d){return d.value;};var originalKeyAccessor=_chart.keyAccessor();_chart.keyAccessor(function(d){return originalKeyAccessor(d)[0];});_chart.valueAccessor(function(d){return originalKeyAccessor(d)[1];});_chart.colorAccessor(function(){return _chart._groupName;});var _locator=function(d){return'translate('+_chart.x()(_chart.keyAccessor()(d))+','+_chart.y()(_chart.valueAccessor()(d))+')';};var _symbolSize=3;var _highlightedSize=5;var _hiddenSize=0;_symbol.size(function(d){if(!_existenceAccessor(d)){return _hiddenSize;}else if(this.filtered){return Math.pow(_highlightedSize,2);}else{return Math.pow(_symbolSize,2);}});dc.override(_chart,'_filter',function(filter){if(!arguments.length){return _chart.__filter();}
return _chart.__filter(dc.filters.RangedTwoDimensionalFilter(filter));});_chart.plotData=function(){var symbols=_chart.chartBodyG().selectAll('path.symbol').data(_chart.data());symbols.enter().append('path').attr('class','symbol').attr('opacity',0).attr('fill',_chart.getColor).attr('transform',_locator);dc.transition(symbols,_chart.transitionDuration()).attr('opacity',function(d){return _existenceAccessor(d)?1:0;}).attr('fill',_chart.getColor).attr('transform',_locator).attr('d',_symbol);dc.transition(symbols.exit(),_chart.transitionDuration()).attr('opacity',0).remove();};_chart.existenceAccessor=function(acc){if(!arguments.length){return _existenceAccessor;}
_existenceAccessor=acc;return this;};_chart.symbol=function(type){if(!arguments.length){return _symbol.type();}
_symbol.type(type);return _chart;};_chart.symbolSize=function(s){if(!arguments.length){return _symbolSize;}
_symbolSize=s;return _chart;};_chart.highlightedSize=function(s){if(!arguments.length){return _highlightedSize;}
_highlightedSize=s;return _chart;};_chart.hiddenSize=function(s){if(!arguments.length){return _hiddenSize;}
_hiddenSize=s;return _chart;};_chart.legendables=function(){return[{chart:_chart,name:_chart._groupName,color:_chart.getColor()}];};_chart.legendHighlight=function(d){resizeSymbolsWhere(function(symbol){return symbol.attr('fill')===d.color;},_highlightedSize);_chart.selectAll('.chart-body path.symbol').filter(function(){return d3.select(this).attr('fill')!==d.color;}).classed('fadeout',true);};_chart.legendReset=function(d){resizeSymbolsWhere(function(symbol){return symbol.attr('fill')===d.color;},_symbolSize);_chart.selectAll('.chart-body path.symbol').filter(function(){return d3.select(this).attr('fill')!==d.color;}).classed('fadeout',false);};function resizeSymbolsWhere(condition,size){var symbols=_chart.selectAll('.chart-body path.symbol').filter(function(){return condition(d3.select(this));});var oldSize=_symbol.size();_symbol.size(Math.pow(size,2));dc.transition(symbols,_chart.transitionDuration()).attr('d',_symbol);_symbol.size(oldSize);}
_chart.setHandlePaths=function(){};_chart.extendBrush=function(){var extent=_chart.brush().extent();if(_chart.round()){extent[0]=extent[0].map(_chart.round());extent[1]=extent[1].map(_chart.round());_chart.g().select('.brush').call(_chart.brush().extent(extent));}
return extent;};_chart.brushIsEmpty=function(extent){return _chart.brush().empty()||!extent||extent[0][0]>=extent[1][0]||extent[0][1]>=extent[1][1];};function resizeFiltered(filter){var symbols=_chart.selectAll('.chart-body path.symbol').each(function(d){this.filtered=filter&&filter.isFiltered(d.key);});dc.transition(symbols,_chart.transitionDuration()).attr('d',_symbol);}
_chart._brushing=function(){var extent=_chart.extendBrush();_chart.redrawBrush(_chart.g());if(_chart.brushIsEmpty(extent)){dc.events.trigger(function(){_chart.filter(null);_chart.redrawGroup();});resizeFiltered(false);}else{var ranged2DFilter=dc.filters.RangedTwoDimensionalFilter(extent);dc.events.trigger(function(){_chart.filter(null);_chart.filter(ranged2DFilter);_chart.redrawGroup();},dc.constants.EVENT_DELAY);resizeFiltered(ranged2DFilter);}};_chart.setBrushY=function(gBrush){gBrush.call(_chart.brush().y(_chart.y()));};return _chart.anchor(parent,chartGroup);};dc.numberDisplay=function(parent,chartGroup){var SPAN_CLASS='number-display';var _formatNumber=d3.format('.2s');var _chart=dc.baseMixin({});var _html={one:'',some:'',none:''};_chart._mandatoryAttributes(['group']);_chart.html=function(s){if(!arguments.length){return _html;}
if(s.none){_html.none=s.none;}else if(s.one){_html.none=s.one;}else if(s.some){_html.none=s.some;}
if(s.one){_html.one=s.one;}else if(s.some){_html.one=s.some;}
if(s.some){_html.some=s.some;}else if(s.one){_html.some=s.one;}
return _chart;};_chart.value=function(){return _chart.data();};_chart.data(function(group){var valObj=group.value?group.value():group.top(1)[0];return _chart.valueAccessor()(valObj);});_chart.transitionDuration(250);_chart._doRender=function(){var newValue=_chart.value(),span=_chart.selectAll('.'+SPAN_CLASS);if(span.empty()){span=span.data([0]).enter().append('span').attr('class',SPAN_CLASS);}
span.transition().duration(_chart.transitionDuration()).ease('quad-out-in').tween('text',function(){var interp=d3.interpolateNumber(this.lastValue||0,newValue);this.lastValue=newValue;return function(t){var html=null,num=_chart.formatNumber()(interp(t));if(newValue===0&&(_html.none!=='')){html=_html.none;}else if(newValue===1&&(_html.one!=='')){html=_html.one;}else if(_html.some!==''){html=_html.some;}
this.innerHTML=html?html.replace('%number',num):num;};});};_chart._doRedraw=function(){return _chart._doRender();};_chart.formatNumber=function(_){if(!arguments.length){return _formatNumber;}
_formatNumber=_;return _chart;};return _chart.anchor(parent,chartGroup);};dc.heatMap=function(parent,chartGroup){var DEFAULT_BORDER_RADIUS=6.75;var _chartBody;var _cols;var _rows;var _xBorderRadius=DEFAULT_BORDER_RADIUS;var _yBorderRadius=DEFAULT_BORDER_RADIUS;var _chart=dc.colorMixin(dc.marginMixin(dc.baseMixin({})));_chart._mandatoryAttributes(['group']);_chart.title(_chart.colorAccessor());var _colsLabel=function(d){return d;};var _rowsLabel=function(d){return d;};_chart.colsLabel=function(_){if(!arguments.length){return _colsLabel;}
_colsLabel=_;return _chart;};_chart.rowsLabel=function(_){if(!arguments.length){return _rowsLabel;}
_rowsLabel=_;return _chart;};var _xAxisOnClick=function(d){filterAxis(0,d);};var _yAxisOnClick=function(d){filterAxis(1,d);};var _boxOnClick=function(d){var filter=d.key;dc.events.trigger(function(){_chart.filter(filter);_chart.redrawGroup();});};function filterAxis(axis,value){var cellsOnAxis=_chart.selectAll('.box-group').filter(function(d){return d.key[axis]===value;});var unfilteredCellsOnAxis=cellsOnAxis.filter(function(d){return!_chart.hasFilter(d.key);});dc.events.trigger(function(){if(unfilteredCellsOnAxis.empty()){cellsOnAxis.each(function(d){_chart.filter(d.key);});}else{unfilteredCellsOnAxis.each(function(d){_chart.filter(d.key);});}
_chart.redrawGroup();});}
dc.override(_chart,'filter',function(filter){if(!arguments.length){return _chart._filter();}
return _chart._filter(dc.filters.TwoDimensionalFilter(filter));});function uniq(d,i,a){return!i||a[i-1]!==d;}
_chart.rows=function(_){if(arguments.length){_rows=_;return _chart;}
if(_rows){return _rows;}
var rowValues=_chart.data().map(_chart.valueAccessor());rowValues.sort(d3.ascending);return d3.scale.ordinal().domain(rowValues.filter(uniq));};_chart.cols=function(_){if(arguments.length){_cols=_;return _chart;}
if(_cols){return _cols;}
var colValues=_chart.data().map(_chart.keyAccessor());colValues.sort(d3.ascending);return d3.scale.ordinal().domain(colValues.filter(uniq));};_chart._doRender=function(){_chart.resetSvg();_chartBody=_chart.svg().append('g').attr('class','heatmap').attr('transform','translate('+_chart.margins().left+','+_chart.margins().top+')');return _chart._doRedraw();};_chart._doRedraw=function(){var rows=_chart.rows(),cols=_chart.cols(),rowCount=rows.domain().length,colCount=cols.domain().length,boxWidth=Math.floor(_chart.effectiveWidth()/colCount),boxHeight=Math.floor(_chart.effectiveHeight()/rowCount);cols.rangeRoundBands([0,_chart.effectiveWidth()]);rows.rangeRoundBands([_chart.effectiveHeight(),0]);var boxes=_chartBody.selectAll('g.box-group').data(_chart.data(),function(d,i){return _chart.keyAccessor()(d,i)+'\0'+_chart.valueAccessor()(d,i);});var gEnter=boxes.enter().append('g').attr('class','box-group');gEnter.append('rect').attr('class','heat-box').attr('fill','white').on('click',_chart.boxOnClick());if(_chart.renderTitle()){gEnter.append('title');boxes.selectAll('title').text(_chart.title());}
dc.transition(boxes.selectAll('rect'),_chart.transitionDuration()).attr('x',function(d,i){return cols(_chart.keyAccessor()(d,i));}).attr('y',function(d,i){return rows(_chart.valueAccessor()(d,i));}).attr('rx',_xBorderRadius).attr('ry',_yBorderRadius).attr('fill',_chart.getColor).attr('width',boxWidth).attr('height',boxHeight);boxes.exit().remove();var gCols=_chartBody.selectAll('g.cols');if(gCols.empty()){gCols=_chartBody.append('g').attr('class','cols axis');}
var gColsText=gCols.selectAll('text').data(cols.domain());gColsText.enter().append('text').attr('x',function(d){return cols(d)+boxWidth/2;}).style('text-anchor','middle').attr('y',_chart.effectiveHeight()).attr('dy',12).on('click',_chart.xAxisOnClick()).text(_chart.colsLabel());dc.transition(gColsText,_chart.transitionDuration()).text(_chart.colsLabel()).attr('x',function(d){return cols(d)+boxWidth/2;});gColsText.exit().remove();var gRows=_chartBody.selectAll('g.rows');if(gRows.empty()){gRows=_chartBody.append('g').attr('class','rows axis');}
var gRowsText=gRows.selectAll('text').data(rows.domain());gRowsText.enter().append('text').attr('dy',6).style('text-anchor','end').attr('x',0).attr('dx',-2).on('click',_chart.yAxisOnClick()).text(_chart.rowsLabel());dc.transition(gRowsText,_chart.transitionDuration()).text(_chart.rowsLabel()).attr('y',function(d){return rows(d)+boxHeight/2;});gRowsText.exit().remove();if(_chart.hasFilter()){_chart.selectAll('g.box-group').each(function(d){if(_chart.isSelectedNode(d)){_chart.highlightSelected(this);}else{_chart.fadeDeselected(this);}});}else{_chart.selectAll('g.box-group').each(function(){_chart.resetHighlight(this);});}
return _chart;};_chart.boxOnClick=function(f){if(!arguments.length){return _boxOnClick;}
_boxOnClick=f;return _chart;};_chart.xAxisOnClick=function(f){if(!arguments.length){return _xAxisOnClick;}
_xAxisOnClick=f;return _chart;};_chart.yAxisOnClick=function(f){if(!arguments.length){return _yAxisOnClick;}
_yAxisOnClick=f;return _chart;};_chart.xBorderRadius=function(d){if(!arguments.length){return _xBorderRadius;}
_xBorderRadius=d;return _chart;};_chart.yBorderRadius=function(d){if(!arguments.length){return _yBorderRadius;}
_yBorderRadius=d;return _chart;};_chart.isSelectedNode=function(d){return _chart.hasFilter(d.key);};return _chart.anchor(parent,chartGroup);};(function(){d3.box=function(){var width=1,height=1,duration=0,domain=null,value=Number,whiskers=boxWhiskers,quartiles=boxQuartiles,tickFormat=null;function box(g){g.each(function(d,i){d=d.map(value).sort(d3.ascending);var g=d3.select(this),n=d.length,min=d[0],max=d[n-1];var quartileData=d.quartiles=quartiles(d);var whiskerIndices=whiskers&&whiskers.call(this,d,i),whiskerData=whiskerIndices&&whiskerIndices.map(function(i){return d[i];});var outlierIndices=whiskerIndices?d3.range(0,whiskerIndices[0]).concat(d3.range(whiskerIndices[1]+1,n)):d3.range(n);var x1=d3.scale.linear().domain(domain&&domain.call(this,d,i)||[min,max]).range([height,0]);var x0=this.__chart__||d3.scale.linear().domain([0,Infinity]).range(x1.range());this.__chart__=x1;var center=g.selectAll('line.center').data(whiskerData?[whiskerData]:[]);center.enter().insert('line','rect').attr('class','center').attr('x1',width/2).attr('y1',function(d){return x0(d[0]);}).attr('x2',width/2).attr('y2',function(d){return x0(d[1]);}).style('opacity',1e-6).transition().duration(duration).style('opacity',1).attr('y1',function(d){return x1(d[0]);}).attr('y2',function(d){return x1(d[1]);});center.transition().duration(duration).style('opacity',1).attr('y1',function(d){return x1(d[0]);}).attr('y2',function(d){return x1(d[1]);});center.exit().transition().duration(duration).style('opacity',1e-6).attr('y1',function(d){return x1(d[0]);}).attr('y2',function(d){return x1(d[1]);}).remove();var box=g.selectAll('rect.box').data([quartileData]);box.enter().append('rect').attr('class','box').attr('x',0).attr('y',function(d){return x0(d[2]);}).attr('width',width).attr('height',function(d){return x0(d[0])-x0(d[2]);}).transition().duration(duration).attr('y',function(d){return x1(d[2]);}).attr('height',function(d){return x1(d[0])-x1(d[2]);});box.transition().duration(duration).attr('y',function(d){return x1(d[2]);}).attr('height',function(d){return x1(d[0])-x1(d[2]);});var medianLine=g.selectAll('line.median').data([quartileData[1]]);medianLine.enter().append('line').attr('class','median').attr('x1',0).attr('y1',x0).attr('x2',width).attr('y2',x0).transition().duration(duration).attr('y1',x1).attr('y2',x1);medianLine.transition().duration(duration).attr('y1',x1).attr('y2',x1);var whisker=g.selectAll('line.whisker').data(whiskerData||[]);whisker.enter().insert('line','circle, text').attr('class','whisker').attr('x1',0).attr('y1',x0).attr('x2',width).attr('y2',x0).style('opacity',1e-6).transition().duration(duration).attr('y1',x1).attr('y2',x1).style('opacity',1);whisker.transition().duration(duration).attr('y1',x1).attr('y2',x1).style('opacity',1);whisker.exit().transition().duration(duration).attr('y1',x1).attr('y2',x1).style('opacity',1e-6).remove();var outlier=g.selectAll('circle.outlier').data(outlierIndices,Number);outlier.enter().insert('circle','text').attr('class','outlier').attr('r',5).attr('cx',width/2).attr('cy',function(i){return x0(d[i]);}).style('opacity',1e-6).transition().duration(duration).attr('cy',function(i){return x1(d[i]);}).style('opacity',1);outlier.transition().duration(duration).attr('cy',function(i){return x1(d[i]);}).style('opacity',1);outlier.exit().transition().duration(duration).attr('cy',function(i){return x1(d[i]);}).style('opacity',1e-6).remove();var format=tickFormat||x1.tickFormat(8);var boxTick=g.selectAll('text.box').data(quartileData);boxTick.enter().append('text').attr('class','box').attr('dy','.3em').attr('dx',function(d,i){return i&1?6:-6;}).attr('x',function(d,i){return i&1?width:0;}).attr('y',x0).attr('text-anchor',function(d,i){return i&1?'start':'end';}).text(format).transition().duration(duration).attr('y',x1);boxTick.transition().duration(duration).text(format).attr('y',x1);var whiskerTick=g.selectAll('text.whisker').data(whiskerData||[]);whiskerTick.enter().append('text').attr('class','whisker').attr('dy','.3em').attr('dx',6).attr('x',width).attr('y',x0).text(format).style('opacity',1e-6).transition().duration(duration).attr('y',x1).style('opacity',1);whiskerTick.transition().duration(duration).text(format).attr('y',x1).style('opacity',1);whiskerTick.exit().transition().duration(duration).attr('y',x1).style('opacity',1e-6).remove();});d3.timer.flush();}
box.width=function(x){if(!arguments.length){return width;}
width=x;return box;};box.height=function(x){if(!arguments.length){return height;}
height=x;return box;};box.tickFormat=function(x){if(!arguments.length){return tickFormat;}
tickFormat=x;return box;};box.duration=function(x){if(!arguments.length){return duration;}
duration=x;return box;};box.domain=function(x){if(!arguments.length){return domain;}
domain=x===null?x:d3.functor(x);return box;};box.value=function(x){if(!arguments.length){return value;}
value=x;return box;};box.whiskers=function(x){if(!arguments.length){return whiskers;}
whiskers=x;return box;};box.quartiles=function(x){if(!arguments.length){return quartiles;}
quartiles=x;return box;};return box;};function boxWhiskers(d){return[0,d.length-1];}
function boxQuartiles(d){return[d3.quantile(d,0.25),d3.quantile(d,0.5),d3.quantile(d,0.75)];}})();dc.boxPlot=function(parent,chartGroup){var _chart=dc.coordinateGridMixin({});function DEFAULT_WHISKERS_IQR(k){return function(d){var q1=d.quartiles[0],q3=d.quartiles[2],iqr=(q3-q1)*k,i=-1,j=d.length;while(d[++i]<q1-iqr){}
while(d[--j]>q3+iqr){}
return[i,j];};}
var _whiskerIqrFactor=1.5;var _whiskersIqr=DEFAULT_WHISKERS_IQR;var _whiskers=_whiskersIqr(_whiskerIqrFactor);var _box=d3.box();var _tickFormat=null;var _boxWidth=function(innerChartWidth,xUnits){if(_chart.isOrdinal()){return _chart.x().rangeBand();}else{return innerChartWidth/(1+_chart.boxPadding())/xUnits;}};_chart.yAxisPadding(12);_chart.x(d3.scale.ordinal());_chart.xUnits(dc.units.ordinal);_chart.data(function(group){return group.all().map(function(d){d.map=function(accessor){return accessor.call(d,d);};return d;}).filter(function(d){var values=_chart.valueAccessor()(d);return values.length!==0;});});_chart.boxPadding=_chart._rangeBandPadding;_chart.boxPadding(0.8);_chart.outerPadding=_chart._outerRangeBandPadding;_chart.outerPadding(0.5);_chart.boxWidth=function(_){if(!arguments.length){return _boxWidth;}
_boxWidth=d3.functor(_);return _chart;};var boxTransform=function(d,i){var xOffset=_chart.x()(_chart.keyAccessor()(d,i));return'translate('+xOffset+', 0)';};_chart._preprocessData=function(){if(_chart.elasticX()){_chart.x().domain([]);}};_chart.plotData=function(){var _calculatedBoxWidth=_boxWidth(_chart.effectiveWidth(),_chart.xUnitCount());_box.whiskers(_whiskers).width(_calculatedBoxWidth).height(_chart.effectiveHeight()).value(_chart.valueAccessor()).domain(_chart.y().domain()).duration(_chart.transitionDuration()).tickFormat(_tickFormat);var boxesG=_chart.chartBodyG().selectAll('g.box').data(_chart.data(),function(d){return d.key;});renderBoxes(boxesG);updateBoxes(boxesG);removeBoxes(boxesG);_chart.fadeDeselectedArea();};function renderBoxes(boxesG){var boxesGEnter=boxesG.enter().append('g');boxesGEnter.attr('class','box').attr('transform',boxTransform).call(_box).on('click',function(d){_chart.filter(d.key);_chart.redrawGroup();});}
function updateBoxes(boxesG){dc.transition(boxesG,_chart.transitionDuration()).attr('transform',boxTransform).call(_box).each(function(){d3.select(this).select('rect.box').attr('fill',_chart.getColor);});}
function removeBoxes(boxesG){boxesG.exit().remove().call(_box);}
_chart.fadeDeselectedArea=function(){if(_chart.hasFilter()){_chart.g().selectAll('g.box').each(function(d){if(_chart.isSelectedNode(d)){_chart.highlightSelected(this);}else{_chart.fadeDeselected(this);}});}else{_chart.g().selectAll('g.box').each(function(){_chart.resetHighlight(this);});}};_chart.isSelectedNode=function(d){return _chart.hasFilter(d.key);};_chart.yAxisMin=function(){var min=d3.min(_chart.data(),function(e){return d3.min(_chart.valueAccessor()(e));});return dc.utils.subtract(min,_chart.yAxisPadding());};_chart.yAxisMax=function(){var max=d3.max(_chart.data(),function(e){return d3.max(_chart.valueAccessor()(e));});return dc.utils.add(max,_chart.yAxisPadding());};_chart.tickFormat=function(x){if(!arguments.length){return _tickFormat;}
_tickFormat=x;return _chart;};return _chart.anchor(parent,chartGroup);};dc.abstractBubbleChart=dc.bubbleMixin;dc.baseChart=dc.baseMixin;dc.capped=dc.capMixin;dc.colorChart=dc.colorMixin;dc.coordinateGridChart=dc.coordinateGridMixin;dc.marginable=dc.marginMixin;dc.stackableChart=dc.stackMixin;dc.d3=d3;dc.crossfilter=crossfilter;return dc;}
if(typeof define==="function"&&define.amd){define(["d3","crossfilter"],_dc);}else if(typeof module==="object"&&module.exports){var _d3=require('d3');var _crossfilter=require('crossfilter');if(typeof _crossfilter!=="function"){_crossfilter=_crossfilter.crossfilter;}
module.exports=_dc(_d3,_crossfilter);}else{this.dc=_dc(d3,crossfilter);}})();